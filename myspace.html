<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Space STI ARCHIVES</title>
  
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style> 
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f8;
      height: 100vh;
      overflow: hidden;
    }

    .main-content {
        display: flex;
        height: calc(100vh - 65px);
        margin-top: 65px;
      }
    .main-navbar {
           display: flex;

           align-items: center;
           position: fixed;
           justify-content: space-between;
            z-index:1000;
             top:0;
             height: 65px;
             width: 100%;


             
             background: #fff;
             box-shadow: 0 2px 8px #0001;
             padding: 0 12px;
             transition: all 0.3s ease;
             


         }
       
       .main-navbar .sti-logo {
           height: 40px;
           width: auto;
           border-radius: 6px;
           margin-left: 30px;
       }
        
        .main-navbar span {
            font-size: 24px;
            font-weight: 700;
            
            margin-left: 10px;
            font-family: 'Poppins', Arial, sans-serif;
            user-select: none;
        }
        .nav-center span {
                font-family: "Alan Sans";
                    cursor: pointer;

        }
        .navbar-right.user-nav-fixed {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 14px;
            font-family: 'Poppins', Arial, sans-serif;
            font-weight: 600;
            color: #132a3f;
            font-size: 16px;
            z-index: 20;
        }

        .dark-mode-toggle {
            background: none;
            border: none;
            outline: none;
            cursor: pointer;
            margin-left: 8px;
            font-size: 24px;
            color: #666666;
            display: flex;
            align-items: center;
        }

        .dark-mode .dark-mode-toggle {
            color: #ffd700;
        }

        .navbar-right.user-nav-fixed .fa-user-circle {
    font-size: 32px; /* Reduced to fit */
    color: #0057b8;
}

        .dark-mode .fa-user-circle {
            color: #ffd700;
        }
        .nav-center {
             position: absolute;
             left: 50%;
             transform: translateX(-50%);
             display: flex;
             gap: 25px;
             color:#1e1e1f;
             align-items: center;
             font-family: 'Poppins', Arial, sans-serif;
             transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
         }


        .dark-mode .nav-text {
            color: #ffd700;
        }
        .dark-mode .main-navbar.shrink .nav-text {
            color: #ffd700;
        }

        .sti-logo {
            display: flex;
            align-items: center;
            height: 40px;
            width: auto;
            border-radius: 6px;
            margin-left: 30px;
        }

        .sti-logo span {
            font-size: 24px;
            font-weight: 700;
            color: #0057b8;
            margin-left: 10px;
            user-select: none;
        }

        .sti-logo a {
            text-decoration: none;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 8%;
            margin-right:10px;
            right: -320px;
            width: 260px;
            height: 65%;
            background: #fff;
            box-shadow: -2px 0 16px #0002;
            z-index: 100;
            transition: right 0.3s cubic-bezier(.4,2,.6,1), visibility 0.3s;
            display: flex;
            flex-direction: column;
            visibility: hidden; /* Hide by default */
            pointer-events: none; /* Prevent interaction when hidden */
            z-index: 10002;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 24px;
        }
        .sidebar.open {
            right: 0;
            visibility: visible; /* Show when open */
            pointer-events: auto;
        }
        .sidebar-content {
            padding: 32px 24px 24px 24px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .close-sidebar {
            background: none;
            border: none;
            font-size: 2rem;
            color: #0057b8;
            align-self: flex-end;
            cursor: pointer;
            margin-bottom: 16px;
        }
        .sidebar-content h3 {
            margin: 0 0 24px 0;
            color: #0057b8;
            font-size: 1.3rem;
            font-weight: 700;
        }
        .sidebar-content ul {
             list-style: none;
             padding: 0 0 0 8px;
             margin: 0;
             flex: 1;
         }
        .sidebar-content ul li {
            margin-bottom: 5px;
        }
        .sidebar-content ul li a {
            color: #132a3f;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 500;
            transition: color 0.2s;
        }
        .sidebar-content ul li a:hover {
            color: #0057b8;
        }
        .account-switcher {
            margin-left: auto;
        }
        .sidebar-content ul {
            margin-top: 20px;
            font-size: 20px;
            font-weight: 600;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #user-Icon {
            font-size: 30px;
            color: #0057b8;
        }
        .user-name h3 {
            margin: 0;
            font-size: 20px;
        }
        .user-name a {
            text-decoration: none;
            color: inherit;
        }

        .dark-mode #user-Icon {
            color: #ffd700;
        }
        .dark-mode .fa-arrow-right-from-bracket {
            color: #ffd700 !important;
        }
        .sidebar-content ul li a {
            color: #0057b8;
            font-size: 1.1rem;
            font-weight: 500;
        }/*END SIDEBAR*/
    .file-viewer {
    flex: 0 0 50%;
    background: #fff;
    border-right: 1px solid #ccc;
    display: flex;
    flex-direction: column;
    overflow-y: hidden;
}

    /* Dark mode styles */
    .dark-mode body {
      background: #181f2a;
    }

    .dark-mode .file-viewer {
      background: #2d2d2d;
      border-right: 1px solid #444;
    }

    .dark-mode .doc-preview {
      background: #2d2d2d;
      color: white;
    }


    .dark-mode .editor {
      background: #2d2d2d;
    }

    

    .dark-mode .toolbar select, .dark-mode .toolbar button, .dark-mode .toolbar input[type="color"] {
      background: #333;
      color: white;
      border: 1px solid #555;
    }

    .dark-mode .toolbar button:hover {
      background: #444;
    }

    .dark-mode .document {
       background: #2d2d2d;
       color: white;
     }

     /* Modal styles */
     .modal-content h2 {
       color: #0057b8;
     }

     .dark-mode .modal-content {
       color: #ffd700;
     }

     .dark-mode .modal-content h2 {
       color: #ffd700;
     }

     .dark-mode .close {
       color: #ffd700;
     }

     .close:hover, .close:focus {
       color: #000;
       text-decoration: none;
       cursor: pointer;
     }

     .dark-mode .close:hover, .dark-mode .close:focus {
       color: #fff;
     }

     /* Save Notification Modal */
     .save-notification-modal {
       position: fixed;
       top: 20px;
       right: -300px;
       z-index: 10000;
       transition: right 0.5s ease;
     }

     .save-notification-modal.show {
       right: 20px;
     }

     .save-notification-content {
       background: #4CAF50;
       color: white;
       padding: 15px 20px;
       border-radius: 5px;
       box-shadow: 0 2px 10px rgba(0,0,0,0.2);
       font-size: 16px;
       font-weight: bold;
     }

     /* Mini document cards */
     .dark-mode #savedDocumentsList > div {
       background: #2d2d2d;
       border-color: #444;
       color: #e2e8f0;
     }

     .dark-mode #savedDocumentsList > div i {
       color: #ffd700;
     }

     .dark-mode #savedDocumentsList > div h4 {
       color: #ffd700;
     }

     .dark-mode #savedDocumentsList > div p {
       color: #a0aec0;
     }

     .dark-mode #savedDocumentsList > div div {
       color: #e2e8f0;
       background: #3d3d3d;
       border-color: #555;
     }



    .dark-mode .committee p {
      color: #ccc;
    }

    .dark-mode .committee em {
      color: #aaa;
    }


.doc-preview {
  text-align: center;
  font-family: 'Times New Roman', serif;

}

.doc-preview h1 {
  font-size: 1.5rem;
  font-weight: bold;
  margin-bottom: 20px;
  line-height: 1.4;
}

.doc-preview .by {
  font-size: 1rem;
  margin: 10px 0;
}

.doc-preview h2 {
  font-size: 1.2rem;
  margin-bottom: 30px;
}

.committee p {
  font-size: 0.95rem;
  margin-bottom: 20px;
}

.committee em {
  display: block;
  font-style: italic;
  font-size: 0.85rem;
  color: #555;
}



    .editor {
        flex: 0 0 50%;
        display: flex;
        flex-direction: column;
        padding: 20px;
        background: #fff;
      }

    .toolbar {
       display: flex;
       gap: 10px;
       margin-bottom: 15px;
       flex-wrap: wrap;
       align-items: center;
       background: transparent;
     }

    .toolbar select, .toolbar button, .toolbar input[type="color"] {
      padding: 6px 10px;
      font-size: 0.9rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #f9f9f9;
      cursor: pointer;
    }

    .toolbar button:hover {
      background: #e0e0e0;
    }

    .document {
      flex: 1;
      max-width: 100%;
      border: 1px solid #ccc;
      border-radius: 12px;
      padding: 30px;
      font-size: 1rem;
      color: #333;
      line-height: 1.6;
      overflow-y: auto;
      overflow-x: hidden;
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: break-word;
      white-space: normal;
    }

    .document[contenteditable="true"] {
      outline: none;
    }

    /* Toggle Panel Styles */
    .toggle-panel {
      position: absolute;
      top: 50%;
      left: calc(50% - 30px);
      transform: translateY(-50%);
      z-index: 10;
    }

    .file-viewer.expanded ~ .toggle-panel {
      left: calc(97% - 30px);
    }

    .toggle-btn {
      background: #2c2c2c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    .toggle-btn:hover {
      background: #4dcedf;
      transform: scale(1.1);
    }

    /* Editor collapse animation */
    .editor {
      transition: all 0.3s ease;
      position: relative;
    }

    .editor.collapsed {
      flex: 0 0 0;
      padding: 0;
      overflow: hidden;
    }

    /* File viewer expand when editor is collapsed */
    .file-viewer {
      transition: width 0.3s ease;
    }

    .file-viewer.expanded {
      flex: 0 0 97%;
    }

    .file-viewer {
      position: relative;
    }

    .select-article {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      padding: 40px;
      border: 2px dashed #ccc;
      border-radius: 10px;
      background-color: #f9f9f9;
      cursor: pointer;
      transition: background-color 0.3s;
      z-index: 10;
    }

    .select-article:hover {
      background-color: #e9e9e9;
    }

    .select-article h2 {
      margin: 0;
      color: #555;
      font-size: 1.5rem;
    }

    /* Dark mode for select article */
    .dark-mode .select-article {
      border-color: #666;
      background-color: #2d2d2d;
      color: #e2e8f0;
    }

    .dark-mode .select-article:hover {
      background-color: #3d3d3d;
    }

    .dark-mode .select-article h2 {
      color: #ffd700;
    }

    /* Hide toolbar and document when collapsed */
    .editor.collapsed .toolbar,
    .editor.collapsed .document {
      display: none;
    }
  </style>
</head>
<body>

  <nav class="main-navbar" id="main-navbar">
    <div class="sti-logo">
      <a href="Homepage.html"><img src="STI Logo.png" alt="STI Logo" class="sti-logo"></a>
      <a href="Homepage.html"><span>ARCHIVES</span></a>
    </div>
    <div style="flex:1"></div>
    <div class="nav-center">
      <div class="nav-item">
        <a href="#home"><span class="nav-text">Home</span></a>
      </div>
      <div class="nav-item">
        <a href="library.html"><span class="nav-text">Library</span></a>
      </div>
      <div class="nav-item">
        <a href="#help"><span class="nav-text">About</span></a>
      </div>
    </div>
    <div class="navbar-right user-nav-fixed">
      <button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode">
        <i class="fa fa-moon"></i>
      </button>
      <i class="fa fa-user-circle" id="userIcon" style="cursor:pointer;"></i>
    </div>
  </nav>

    <div class="main-content">
     <div class="file-viewer expanded">
       <!-- Select Article Container -->
       <div class="select-article" id="selectArticle" onclick="goToLibrary()">
         <h2>Select an Article</h2>
       </div>

       <!-- Document Preview -->
       <div class="doc-preview" id="docPreview" style="display: none;">
         <!-- Pages will be generated dynamically -->
       </div>
     </div>

    <div class="toggle-panel">
      <button class="toggle-btn" id="closeEditor" style="display: none;">></button>
      <button class="toggle-btn" id="openEditor"><</button>
    </div>

  <!-- Document Editor -->
  <div class="editor collapsed" id="editor">
    <div class="toolbar">
      <select onchange="format('fontName', this.value)">
        <option value="Arial">Arial</option>
        <option value="Georgia">Georgia</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Courier New">Courier New</option>
      </select>

      <button onclick="adjustFontSize(1)">A+</button>
      <button onclick="adjustFontSize(-1)">A‚àí</button>

      <button onclick="format('bold')"><b>B</b></button>
      <button onclick="format('italic')"><i>I</i></button>

      <select onchange="applyUnderlineStyle(this.value)">
        <option value="underline">Underline: Solid</option>
        <option value="dotted">Dotted</option>
        <option value="dashed">Dashed</option>
        <option value="wavy">Wavy</option>
        <option value="none">None</option>
      </select>

      <input type="color" onchange="format('foreColor', this.value)" title="Text Color" />

      <button onclick="format('justifyLeft')">‚¨ÖÔ∏è</button>
      <button onclick="format('justifyCenter')">‚ÜîÔ∏è</button>
      <button onclick="format('justifyRight')">‚û°Ô∏è</button>
      <button onclick="format('justifyFull')">üìÑ</button>

      <select onchange="setLineHeight(this.value)">
        <option value="1.2">Line spacing: 1.2</option>
        <option value="1.5">1.5</option>
        <option value="2">2.0</option>
        <option value="2.5">2.5</option>
      </select>

      <input type="text" id="docTitle" placeholder="Untitled document" style="padding: 6px 10px; font-size: 0.9rem; border: 1px solid #ccc; border-radius: 6px; background: #f9f9f9; margin-right: 10px; width: 200px;" />
      <button onclick="saveDocument()" title="Save Document"><i class="fas fa-save"></i> Save</button>
      <button onclick="resetDocument()" title="New Document"><i class="fas fa-file"></i> New</button>
      <button onclick="openSavedDocumentsModal()" title="Saved Documents"><i class="fas fa-folder-open"></i> Menu</button>
      <button onclick="downloadDocument()" title="Download Document"><i class="fas fa-download"></i></button>
      <button onclick="printDocument()" title="Print Document"><i class="fas fa-print"></i></button>
    </div>

    <div class="document" contenteditable="true" id="doc" data-placeholder="Start Typing Your Document Here..">Start Typing Your Document Here..</div>
  </div>

  <!-- Saved Documents Modal -->
  <div id="savedDocumentsModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
    <div class="modal-content" style="background-color: #fff; padding: 20px; width: 80%; max-width: 800px; border-radius: 8px;">
      <span class="close" onclick="closeSavedDocumentsModal()" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
      <h2 style="margin-top: 0;">Saved Documents</h2>
      <div id="savedDocumentsList" style="max-height: 400px; overflow-y: auto;"></div>
    </div>
  </div>

  <!-- Writer Modal -->
  <div id="writerModal" style="display: block; position: absolute; left: calc(87% - 15px); top: calc(55% - 100px); background: rgba(0,0,0,0.3); width: auto; height: auto; border-radius: 5px;">
    <div style="background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); position: relative;">
      <span style="padding-right: 20px;">Document Writer here</span>
      <span onclick="closeWriterModal()" style="position: absolute; top: 5px; right: 5px; cursor: pointer; font-weight: bold;">&times;</span>
    </div>
  </div>

  <!-- Save Notification Modal -->
  <div id="saveNotificationModal" class="save-notification-modal" style="display: none;">
    <div class="save-notification-content">
      <span id="saveMessage">Document Saved Successfully!</span>
    </div>
  </div>
    </div>
    <script src="script.js"></script>
    <script>
        let currentLoadedDocId = null;
        // Article viewer functions (page navigation removed)



        // Document writer tools functions
        function format(command, value) {
            document.execCommand(command, false, value);
        }

        function adjustFontSize(delta) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const selectedText = range.toString();
                if (selectedText) {
                    const span = document.createElement('span');
                    const currentSize = window.getComputedStyle(range.startContainer.parentElement).fontSize;
                    const newSize = parseInt(currentSize) + delta;
                    span.style.fontSize = newSize + 'px';
                    span.textContent = selectedText;
                    range.deleteContents();
                    range.insertNode(span);
                }
            }
        }

        function applyUnderlineStyle(style) {
            if (style === 'none') {
                document.execCommand('underline', false, false);
            } else {
                document.execCommand('underline', false, true);
            }
        }

        function setLineHeight(value) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const selectedText = range.toString();
                if (selectedText) {
                    const div = document.createElement('div');
                    div.style.lineHeight = value;
                    div.textContent = selectedText;
                    range.deleteContents();
                    range.insertNode(div);
                }
            }
        }

        function downloadDocument() {
            const doc = document.getElementById('doc');
            const content = doc.innerHTML;
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        function printDocument() {
            const navbar = document.querySelector('.main-navbar');
            const fileViewer = document.querySelector('.file-viewer');
            const togglePanel = document.querySelector('.toggle-panel');
            const toolbar = document.querySelector('.toolbar');
            const documentElement = document.querySelector('.document');

            // Hide other elements and modify document styling for print
            const originalDisplays = {};
            const originalDocumentStyles = {};

            if (navbar) {
                originalDisplays.navbar = navbar.style.display;
                navbar.style.display = 'none';
            }
            if (fileViewer) {
                originalDisplays.fileViewer = fileViewer.style.display;
                fileViewer.style.display = 'none';
            }
            if (togglePanel) {
                originalDisplays.togglePanel = togglePanel.style.display;
                togglePanel.style.display = 'none';
            }
            if (toolbar) {
                originalDisplays.toolbar = toolbar.style.display;
                toolbar.style.display = 'none';
            }
            if (documentElement) {
                // Remove border, border-radius, and padding for clean printing
                originalDocumentStyles.border = documentElement.style.border;
                originalDocumentStyles.borderRadius = documentElement.style.borderRadius;
                originalDocumentStyles.padding = documentElement.style.padding;
                documentElement.style.border = 'none';
                documentElement.style.borderRadius = '0';
                documentElement.style.padding = '0';
            }

            // Create print-specific styles
            const printStyle = document.createElement('style');
            printStyle.id = 'print-styles';
            printStyle.textContent = `
                @media print {
                    @page {
                        size: auto;
                        margin: 0;
                        margin-bottom: 0;
                    }
                    html, body {
                        height: auto !important;
                        overflow: visible !important;
                    }
                    body::before, body::after {
                        display: none !important;
                    }
                    .document {
                        page-break-inside: avoid;
                        break-inside: avoid;
                    }
                }
            `;
            document.head.appendChild(printStyle);

            // Print the page
            window.print();

            // Remove print styles and restore original displays and styles
            const addedStyle = document.getElementById('print-styles');
            if (addedStyle) {
                document.head.removeChild(addedStyle);
            }

            if (navbar) navbar.style.display = originalDisplays.navbar || '';
            if (fileViewer) fileViewer.style.display = originalDisplays.fileViewer || '';
            if (togglePanel) togglePanel.style.display = originalDisplays.togglePanel || '';
            if (toolbar) toolbar.style.display = originalDisplays.toolbar || '';
            if (documentElement) {
                documentElement.style.border = originalDocumentStyles.border || '';
                documentElement.style.borderRadius = originalDocumentStyles.borderRadius || '';
                documentElement.style.padding = originalDocumentStyles.padding || '';
            }
        }

        // Save document function
        function saveDocument() {
            const title = document.getElementById('docTitle').value.trim() || 'Untitled document';
            const content = document.getElementById('doc').innerHTML;
            const savedDocuments = JSON.parse(localStorage.getItem('savedDocuments')) || [];
            const isDuplicate = savedDocuments.some(d => d.title === title && d.content === content);
            if (isDuplicate) {
                // Document already saved
                document.getElementById('saveMessage').textContent = 'Document Already Saved!';
            } else {
                // Save the document
                if (currentLoadedDocId) {
                    const index = savedDocuments.findIndex(d => d.id === currentLoadedDocId);
                    if (index !== -1) {
                        // Update existing
                        savedDocuments[index] = {
                            ...savedDocuments[index],
                            title: title,
                            content: content,
                            date: new Date().toISOString()
                        };
                    } else {
                        // Document was deleted, save as new
                        currentLoadedDocId = null;
                        const doc = {
                            id: Date.now(),
                            title: title,
                            content: content,
                            date: new Date().toISOString()
                        };
                        savedDocuments.push(doc);
                        currentLoadedDocId = doc.id;
                    }
                } else {
                    // Add new
                    const doc = {
                        id: Date.now(),
                        title: title,
                        content: content,
                        date: new Date().toISOString()
                    };
                    savedDocuments.push(doc);
                    currentLoadedDocId = doc.id;
                }
                localStorage.setItem('savedDocuments', JSON.stringify(savedDocuments));
                console.log('Document saved to localStorage:', savedDocuments); // Debug log

                // Trigger update in pfp.html if it's open
                if (window.parent !== window) {
                    // If in iframe, try to communicate with parent
                    window.parent.postMessage({type: 'documentSaved', document: doc}, '*');
                } else {
                    // Try to update pfp.html if it's open in another tab/window
                    localStorage.setItem('documentUpdateTrigger', Date.now().toString());
                }

                document.getElementById('saveMessage').textContent = 'Document Saved Successfully!';
            }
            // Show save notification modal
            const modal = document.getElementById('saveNotificationModal');
            modal.style.display = 'block';
            modal.classList.add('show');
            setTimeout(() => {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 500);
            }, 5000);
        }

        // Reset document function
        function resetDocument() {
            document.getElementById('docTitle').value = '';
            document.getElementById('doc').innerHTML = 'Start Typing Your Document Here..';
            currentLoadedDocId = null;
        }

        // Open saved documents modal
        function openSavedDocumentsModal() {
            const modal = document.getElementById('savedDocumentsModal');
            const modalContent = document.querySelector('#savedDocumentsModal .modal-content');
            modal.style.display = 'block';
            modalContent.style.position = 'relative';
            modalContent.style.top = '50%';
            modalContent.style.transform = 'translateY(-50%)';
            modalContent.style.margin = '0 auto';
            const list = document.getElementById('savedDocumentsList');
            const savedDocuments = JSON.parse(localStorage.getItem('savedDocuments')) || [];
            list.innerHTML = '';
            if (savedDocuments.length === 0) {
                list.innerHTML = '<p>No saved documents yet.</p>';
            } else {
                savedDocuments.forEach(doc => {
                    const item = document.createElement('div');
                    item.style.display = 'inline-block';
                    item.style.width = '200px';
                    item.style.height = '300px';
                    item.style.margin = '10px';
                    item.style.verticalAlign = 'top';
                    item.style.background = '#f9f9f9';
                    item.style.border = '1px solid #ccc';
                    item.style.borderRadius = '8px';
                    item.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
                    const contentPreview = doc.content.replace(/<[^>]*>/g, '').substring(0, 100) + (doc.content.replace(/<[^>]*>/g, '').length > 100 ? '...' : '');
                    item.innerHTML = `
                        <div class="sd-header" style="padding: 10px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="font-weight: bold; font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1;">${doc.title}</span>
                                <span style="font-size: 10px; color: #666;">${new Date(doc.date).toLocaleDateString()}</span>
                            </div>
                            <button onclick="loadDocument(${doc.id})" style="padding: 4px 8px; background: #0057b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; margin-right: 5px;">Load</button>
                            <button onclick="sendToPfp(${doc.id})" style="padding: 4px 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; margin-right: 5px;">Send to PFP</button>
                            <button onclick="deleteDocument(${doc.id})" style="padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Delete</button>
                        </div>
                        <div class="document" style="border: 1px solid #ccc; border-radius: 0; padding: 8px; height: 200px; width: 150px; overflow: hidden; font-size: 10px; color: #333; background: #fff; margin: 0 auto;">${contentPreview}</div>
                    `;
                    list.appendChild(item);
                });
            }
            modal.style.display = 'block';
        }

        // Close modal
        function closeSavedDocumentsModal() {
            document.getElementById('savedDocumentsModal').style.display = 'none';
        }

        // Close writer modal
        function closeWriterModal() {
            document.getElementById('writerModal').style.display = 'none';
        }

        // Load document
        function loadDocument(id) {
            const savedDocuments = JSON.parse(localStorage.getItem('savedDocuments')) || [];
            const doc = savedDocuments.find(d => d.id === id);
            if (doc) {
                currentLoadedDocId = id;
                document.getElementById('docTitle').value = doc.title;
                document.getElementById('doc').innerHTML = doc.content;
                closeSavedDocumentsModal();
            }
        }

        // Send document to pfp.html
        function sendToPfp(id) {
            const savedDocuments = JSON.parse(localStorage.getItem('savedDocuments')) || [];
            const doc = savedDocuments.find(d => d.id === id);
            if (doc) {
                // Add to pfp documents (could be a separate storage or same)
                const pfpDocuments = JSON.parse(localStorage.getItem('pfpDocuments')) || [];
                const existingIndex = pfpDocuments.findIndex(d => d.id === id);

                if (existingIndex === -1) {
                    // Add new document to pfp
                    pfpDocuments.push({
                        ...doc,
                        sentFromMyspace: true,
                        sentDate: new Date().toISOString()
                    });
                    localStorage.setItem('pfpDocuments', JSON.stringify(pfpDocuments));

                    // Trigger update in pfp.html
                    localStorage.setItem('pfpDocumentUpdate', Date.now().toString());

                    alert('Document sent to Profile page successfully!');
                } else {
                    alert('Document already exists in Profile page!');
                }
            }
        }

        // Delete document
        function deleteDocument(id) {
            const savedDocuments = JSON.parse(localStorage.getItem('savedDocuments')) || [];
            const updated = savedDocuments.filter(d => d.id !== id);
            localStorage.setItem('savedDocuments', JSON.stringify(updated));
            openSavedDocumentsModal(); // Refresh the list
        }


        // Load article from pfp saved articles
        function loadArticleFromPfp(article) {
            document.getElementById('selectArticle').style.display = 'none';
            document.getElementById('docPreview').style.display = 'block';

            // Clear existing content
            const docPreview = document.getElementById('docPreview');
            docPreview.innerHTML = '';

            if (article.pdfUrl) {
                // Create iframe for PDF
                const iframe = document.createElement('iframe');
                iframe.src = `https://drive.google.com/file/d/${article.pdfUrl}/preview`;
                iframe.style.width = '100%';
                iframe.style.height = '93vh';
                iframe.style.border = 'none';

                docPreview.appendChild(iframe);
            } else {
                // No PDF available, show article details
                docPreview.innerHTML = `
                    <div class="doc-preview">
                        <h1>${article.title}</h1>
                        ${article.author ? `<div class="by">By: ${article.author}</div>` : ''}
                        ${article.meta ? `<p><strong>Meta:</strong> ${article.meta}</p>` : ''}
                        ${article.summary ? `<h2>Summary</h2><p>${article.summary}</p>` : ''}
                        <p><em>PDF not available for this article.</em></p>
                    </div>
                `;
            }
        }

        // Study viewer functionality
        function goToLibrary() {
            // Save current editor state
            const title = document.getElementById('docTitle').value;
            const content = document.getElementById('doc').innerHTML;
            localStorage.setItem('editorState', JSON.stringify({title, content}));
            window.location.href = 'library.html?from=myspace';
        }

        function goToPfp(id) {
            // Save current editor state
            const title = document.getElementById('docTitle').value;
            const content = document.getElementById('doc').innerHTML;
            localStorage.setItem('editorState', JSON.stringify({title, content}));
            window.location.href = 'pfp.html?from=myspace&id=' + id;
        }

        function loadStudy(studyId) {
            // First, check if it's a predefined study
            const predefinedStudies = {
                'professional_perspective': {
                    title: 'Professionals Perspective on the Structural Relialibility of Bamboo in Philippines Housing Projects',
                    fileIds: ['1ZJd0BAeDr0wUiFzhm45hcwx6EGlIvwYG']
                },
                'perceptions': {
                    title: 'Farmers Perceptions on the Effectiveness of Ventilation to Hinder Pesticide Exposure',
                    fileIds: ['1ZJd0BAeDr0wUiFzhm45hcwx6EGlIvwYG']
                },
                'safety_measure': {
                    title: 'Exploring Public Awareness and Safety Measures for Microplastic Consumption in Fish',
                    fileIds: ['1Gr3-XbFEkM4Y5hhT4jDABXus0htk3FBS']
                },
                'safety_protocols': {
                    title: 'Analyzing Safety Protocals Adherence in Gasoline Stations: Urban vs. Rural Perspectives',
                    fileIds: ['1oycCEjyM5Wwlyz9HYzo8B-Hv_yjddemN']
                },
                'trash_treasure': {
                    title: 'Trash to Treasure: The Role of Recycling Technologies in Sustainable Future',
                    fileIds: ['1zGFTJMgLXbqTEwOhOK7YhcoJyGtHBYhn']
                },
                'lagundi_oil': {
                    title: 'The Effectiveness of Lagundi Essential Oil as an Inhaler in Terms of Marketability Among Selected Grade-11 Senior High School Students in STI College Calamba',
                    fileIds: ['1nLccvtasOdYnOOWEDiUBBXQmj2nTelrZ']
                }
            };

            let study = predefinedStudies[studyId];

            // If not a predefined study, look in allArticles from localStorage
            if (!study) {
                const allArticles = JSON.parse(localStorage.getItem('allArticles')) || [];
                const normalizedStudyId = studyId.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 20);
                const article = allArticles.find(a => {
                    const articleStudyId = a.title.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 20);
                    return articleStudyId === normalizedStudyId;
                });

                if (article) {
                    study = {
                        title: article.title,
                        authors: article.authors,
                        summary: article.summary,
                        fileIds: article.fileIds || []
                    };
                }
            }

            if (study) {
                document.getElementById('selectArticle').style.display = 'none';
                document.getElementById('docPreview').style.display = 'block';

                // Clear existing pages
                const docPreview = document.getElementById('docPreview');
                docPreview.innerHTML = '';

                if (study.fileIds && study.fileIds.length > 0) {
                    // Generate pages dynamically based on file IDs
                    study.fileIds.forEach((fileId, index) => {
                        const pageNum = index + 1;
                        const pageDiv = document.createElement('div');
                        pageDiv.id = `page${pageNum}`;
                        pageDiv.style.display = pageNum === 1 ? 'block' : 'none';

                        const iframe = document.createElement('iframe');
                        iframe.src = `https://drive.google.com/file/d/${fileId}/preview`;
                        iframe.style.width = '100%';
                        iframe.style.height = '93vh';
                        iframe.style.border = 'none';

                        pageDiv.appendChild(iframe);
                        docPreview.appendChild(pageDiv);
                    });
                } else {
                    // No PDF available, show article details
                    docPreview.innerHTML = `
                        <div class="doc-preview">
                            <h1>${study.title}</h1>
                            ${study.authors ? `<div class="by">By: ${study.authors}</div>` : ''}
                            ${study.summary ? `<h2>Abstract</h2><p>${study.summary}</p>` : ''}
                            <p><em>PDF not yet uploaded. Please check back later.</em></p>
                        </div>
                    `;
                }
            } else {
                // Study not found, show error
                document.getElementById('selectArticle').innerHTML = '<h2>Article not found</h2><p>The requested article could not be found.</p>';
            }
        }

        // Check for study parameter or article from pfp on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved editor state
            const editorState = JSON.parse(localStorage.getItem('editorState'));
            if (editorState) {
                document.getElementById('docTitle').value = editorState.title;
                document.getElementById('doc').innerHTML = editorState.content;
                localStorage.removeItem('editorState');
            }

            const urlParams = new URLSearchParams(window.location.search);
            const studyId = urlParams.get('study');
            const fromPfp = urlParams.get('from') === 'pfp';
            const articleTitle = urlParams.get('article');

            if (studyId) {
                loadStudy(studyId);
            } else if (fromPfp && articleTitle) {
                // Load article from pfp saved articles
                const selectedArticle = JSON.parse(localStorage.getItem('selectedArticle'));
                if (selectedArticle) {
                    loadArticleFromPfp(selectedArticle);
                    localStorage.removeItem('selectedArticle'); // Clean up
                }
            }
        });

        // Placeholder for document editor
        const doc = document.getElementById('doc');
        const placeholder = doc.dataset.placeholder;

        doc.addEventListener('focus', function() {
            if (doc.textContent.trim() === placeholder) {
                doc.textContent = '';
            }
        });

        doc.addEventListener('blur', function() {
            if (doc.textContent.trim() === '') {
                doc.textContent = placeholder;
            }
        });
    </script>
</body>
</html>


