<!--library.html-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>Document</title>
  <style>
   body {
     margin: 0;
     padding: 0;
     font-family: 'Segoe UI', sans-serif;
     display: flex;
     flex-direction: column;
     min-height: 100vh;
   }
   .content-wrapper {
     display: flex;
     flex-direction: row;
     flex: 1;
   }
   .library-footer {
     margin-top: auto;
     margin-bottom: auto;
   }
   .sidebarlft {
     width: 240px;
     background: #fff;
     border-right: 1px solid #ddd;
     padding: 20px;
     flex-shrink: 0;
   }
   .main {
     flex: 1;
     padding: 20px 40px;
     background: #f8f9fa;
   }
   .library-footer {
     background: #002244;
     border-top: 1px solid #ddd;
     padding: 20px;
     text-align: center;
     color: #fff;
     font-size: 14px;
     height: 200px;
   }
   .dark-mode .library-footer {
     background: #181f2a;
     border-top-color: #374151;
     color: #ffd700;
   }
   .search-wrapper {
     display: flex;
     flex-direction: column;
     gap: .25rem;
     background-color: #fff;
     height:28px;
     width:300px;
   }
   .search-wrapper label {
     font-size: 1.2rem;
     font-weight: 600;
     padding-top:10%;
   }
   input {
     font-size: 1rem;
   }
   .user-cards {
     display: grid;
     grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
     gap: .25rem;
     margin-top: 1rem;
     margin-left: 10%;
     margin-right: 10%;
   }
   .card {
     border: 1px solid black;
     background-color: white;
     padding: .5rem;
   }
   .card > .header {
     margin-bottom: .25rem;
   }
   .card > .body {
     font-size: .8rem;
     color: #777;
   }
   .hide {
     display: none;
   }
   .STI-logo {
       display: flex;
       align-items: center;
   }
   .STI-logo span {
       font-size: 24px;
       color: #0057b8;
   }
   .sidebar-down h3 {
     margin-bottom: 15px;
     font-size: 1rem;
     color: #333;
   }
   .sidebarlft ul {
     list-style: none;
     margin-bottom: 20px;
   }
   .sidebarlft li {
     margin-bottom: 10px;
     cursor: pointer;
     color: #444;
   }
   .sidebarlft li:hover {
     text-decoration: underline;
   }
   .filter-option {
     cursor: pointer;
     padding: 5px 0;
     transition: color 0.3s ease;
   }
   .filter-option.active {
     color: #0057b8;
     font-weight: bold;
   }
   .dark-mode .filter-option.active {
     color: #0057b8;
   }
   .filter-option:hover {
     color: #0057b8;
   }
   .sidebarlft input[type="checkbox"] {
     margin-right: 6px;
   }
   .create-alert {
     margin-top: 20px;
     font-size: 0.9rem;
     color: #132a3f;
     cursor: pointer;
   }
   .dark-mode .create-alert {
     color: white;
   }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .topbar h2 {
       font-size: 1.2rem;
       color: #333;
     }
     .topbar .links {
       display: flex;
       gap: 20px;
       font-size: 0.9rem;
       color: #555;
     }
     .dropdown {
       position: relative;
       display: inline-block;
     }
     .dropdown-toggle {
       background: #0057b8;
       color: #fff;
       padding: 8px 16px;
       border-radius: 6px;
       cursor: pointer;
       font-size: 14px;
       transition: background 0.3s;
       text-decoration: none;
       display: inline-block;
     }
     .dropdown-toggle:hover {
       background: #003f8a;
     }
     .dropdown-menu1 {
       position: absolute;
       top: 100%;
       left: 0;
       background: #fff;
       border-radius: 6px;
       box-shadow: 0 4px 12px rgba(0,0,0,0.15);
       padding: 4px 0;
       min-width: 150px;
       display: none;
       z-index: 10;
       border: 1px solid #ddd;
     }
     .dropdown:hover .dropdown-menu1 {
       display: block;
     }
     .dropdown-menu2 {
       position: absolute;
       top: 100%;
       left: 0;
       background: #fff;
       border-radius: 6px;
       box-shadow: 0 4px 12px rgba(0,0,0,0.15);
       padding: 4px 0;
       min-width: 150px;
       display: none;
       z-index: 10;
       border: 1px solid #ddd;
     }
     .dropdown:hover .dropdown-menu2 {
       display: block;
     }
     .dropdown-menu1 div {
       
       font-size: 14px;
       color: #333;
       cursor: pointer;
       transition: background 0.2s;
     }
     
     .dropdown-menu2 div {
       padding: 6px 16px;
       font-size: 14px;
       color: #333;
       cursor: pointer;
       transition: background 0.2s;
     }
     
     .sub-dropdown {
       position: relative;
     }
     .sub-dropdown-toggle {
       padding: 6px 16px;
       font-size: 14px;
       color: #333;
       cursor: pointer;
       transition: background 0.2s;
     }
     
     .sub-dropdown-menu {
       position: absolute;
       top: 0;
       left: 100%;
       background: #fff;
       border-radius: 6px;
       box-shadow: 0 4px 12px rgba(0,0,0,0.15);
       padding: 8px 0;
       min-width: 150px;
       display: none;
       z-index: 10;
       border: 1px solid #ddd;
     }
     .sub-dropdown:hover .sub-dropdown-menu {
       display: block;
     }
     .sub-dropdown-menu div {
       padding: 6px 16px;
       font-size: 14px;
       color: #333;
       cursor: pointer;
       transition: background 0.2s;
     }
     .sub-dropdown-menu div[data-strand="ABM"]:hover {
       background: #ffebee;
       color: #ff5722;
     }
     .sub-dropdown-menu div[data-strand="CulArts"]:hover {
       background: #f3e5f5;
       color: #9c27b0;
     }
     .sub-dropdown-menu div[data-strand="ITMAWD"]:hover {
       background: #e8f5e8;
       color: #4caf50;
     }
     .sub-dropdown-menu div[data-strand="STEM"]:hover {
       background: #e3f2fd;
       color: #2196f3;
     }
     .dark-mode .dropdown-menu {
       background: #232f41;
       border: 1px solid #374151;
       box-shadow: 0 4px 12px rgba(0,0,0,0.3);
     }
     .dark-mode .dropdown-menu div {
       color: #e2e8f0;
     }
     .dark-mode .dropdown-menu div:hover {
       background: #374151;
       color: #ffd700;
     }
     .dark-mode .sub-dropdown-toggle {
       color: #e2e8f0;
     }
     .dark-mode .sub-dropdown-toggle:hover {
       background: #374151;
       color: #ffd700;
     }
     .dark-mode .sub-dropdown-menu {
       background: #232f41;
       border: 1px solid #374151;
       box-shadow: 0 4px 12px rgba(0,0,0,0.3);
     }
     .dark-mode .sub-dropdown-menu div {
       color: #e2e8f0;
     }
     .dark-mode .sub-dropdown-menu div[data-strand="ABM"]:hover {
       background: #ffebee;
       color: #ff5722;
     }
     .dark-mode .sub-dropdown-menu div[data-strand="CulArts"]:hover {
       background: #f3e5f5;
       color: #9c27b0;
     }
     .dark-mode .sub-dropdown-menu div[data-strand="ITMAWD"]:hover {
       background: #e8f5e8;
       color: #4caf50;
     }
     .dark-mode .sub-dropdown-menu div[data-strand="STEM"]:hover {
       background: #e3f2fd;
       color: #2196f3;
     }
    .result-count {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 20px;
    }
    .article {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px #0001;
      margin-bottom: 20px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .article:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px #0002;
    }
    .article h3 {
      color: #0057b8;
      font-size: 1rem;
      margin-bottom: 6px;
      cursor: pointer;
    }
    .article .meta {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 10px;
    }
    .article .summary {
      font-size: 0.9rem;
      color: #333;
      margin-bottom: 10px;
    }
    .article .actions {
      font-size: 0.85rem;
      color: #1a0dab;
      display: flex;
      gap: 20px;
      cursor: pointer;
    }
    .dark-mode .article .actions {
      color: #00a6ff;
    }
    .article .actions span:hover  {
      text-decoration: underline;
      color: #00a6ff !important;
    }
    .article .actions span:first-child {
      color: #1a0dab;
    }
    .dark-mode .actions span:first-child {
      color: #00a6ff;
    }
    .article .actions span:nth-child(2) {
      color: #1a0dab !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      text-decoration: none !important;
      background: none !important;
      border: none !important;
      padding: 0 !important;
      border-radius: 0 !important;
      box-shadow: none !important;
      position: relative !important;
    }
    .article .actions span:nth-child(2):hover {
      color: #00a6ff !important;
    }
    .dark-mode .article .actions span:nth-child(2) {
      color: #00a6ff !important;
    }
    .source-tag {
      font-size: 0.8rem;
      color: #007bff;
      float: right;
    }
    .dark-mode .content-wrapper {
      background: #181f2a;
    }
    .dark-mode .sidebarlft {
      background: #232f41;
      color: #e2e8f0;
    }
    .dark-mode .sidebarlft h3 {
      color: #ffd700;
    }
    .dark-mode .sidebarlft li {
      color: #e2e8f0;
    }
    .dark-mode .main {
      background: #181f2a;
      color: #e2e8f0;
    }
    .dark-mode .article {
      background: #232f41;
      color: #e2e8f0;
    }
    .dark-mode .article h3 {
      color: #ffd700;
    }
    .dark-mode .article .meta {
      color: #b0b7c3;
    }
    .dark-mode .article .summary {
      color: #e2e8f0;
    }
    .dark-mode .result-count {
      color: #b0b7c3;
    }
    .dark-mode .upload-date {
      color: #b0b7c3;
    }
    .search-filter-bar {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      background: none;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: none;
      gap: 15px;
      width: 100%;
      max-width: 600px;
      transition: all 0.3s ease;
    }
    .search-filter-bar.shrink {
      padding: 6px 10px;
      max-width: 450px;
      gap: 10px;
    }
    .search-filter-bar.shrink .search-input {
      font-size: 13px;
      padding: 8px 12px;
    }
    .search-filter-bar.shrink .search-btn {
      font-size: 13px;
      padding: 8px 12px;
    }
    .search-container {
      display: flex;
      flex: 1;
      width:500px;
      max-width: 600px;
      position: relative;
    }
    .search-input {
      flex: 1;
      padding: 10px 25px;
      border: 1px solid #ddd;
      border-radius: 25px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s;
      background: transparent;
    }
    .search-input:focus {
      border-color: #0057b8;
    }
    
    .filter-container {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .filter-select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      min-width: 150px;
      transition: border-color 0.3s;
    }
    .filter-select:focus {
      border-color: #0057b8;
      outline: none;
    }
    .filter-select:disabled {
      background: #f5f5f5;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .dark-mode .search-input {
      background: #374151;
      color: #e2e8f0;
      border-color: #4b5563;
    }
    .dark-mode .search-input:focus {
      border-color: #ffd700;
    }
    .dark-mode .filter-select {
      background: #374151;
      color: #e2e8f0;
      border-color: #4b5563;
    }
    .dark-mode .filter-select:focus {
      border-color: #ffd700;
    }
    .dark-mode .filter-select option {
      background: #374151;
      color: #e2e8f0;
    }
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 8px 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .search-suggestions.show {
      display: block;
    }
    .suggestion-item {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 1px solid #f0f0f0;
      transition: background-color 0.2s;
    }
    .suggestion-item:hover,
    .suggestion-item.active {
      background-color: #f8f9fa;
    }
    .suggestion-item:last-child {
      border-bottom: none;
    }
    .dark-mode .search-suggestions {
      background: #232f41;
      border-color: #4b5563;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .dark-mode .suggestion-item {
      color: #e2e8f0;
      border-bottom-color: #374151;
    }
    .dark-mode .suggestion-item:hover,
    .dark-mode .suggestion-item.active {
      background-color: #374151;
    }
    .section {
      margin-bottom: 20px;
    }
    .section h2 {
      color: #0057b8;
      font-size: 1.5rem;
      margin-bottom: 20px;
      border-bottom: 2px solid #0057b8;
      padding-bottom: 10px;
    }
    .dark-mode .section h2 {
      color: #ffd700;
      border-bottom-color: #ffd700;
    }
    mark {
      background-color: #ffd700;
      color: #000;
      padding: 0 2px;
      border-radius: 2px;
      font-weight: bold;
    }
    .dark-mode mark {
      background-color: #ffd700;
      color: #000;
    }
    .article[data-category="research"] {
      border-left: 4px solid #ffd700 !important;
    }
    .article[data-category="capstone"] {
      border-left: 4px solid #0057b8 !important;
    }
    .section-title {
      color: #0057b8;
      font-size: 2rem;
      margin-bottom: 30px;
      border-bottom: 3px solid #0057b8;
      padding-bottom: 15px;
      font-weight: 600;
    }
    .dark-mode .section-title {
      color: #ffd700;
      border-bottom-color: #ffd700;
    }
    .subsection {
      margin-bottom: 40px;
    }
    .subsection-title {
      color: #333;
      font-size: 1.4rem;
      margin-bottom: 20px;
      padding: 10px 15px;
      background: #f8f9fa;
      border-left: 4px solid #0057b8;
      border-radius: 0 8px 8px 0;
      font-weight: 500;
    }
    .dark-mode .subsection-title {
      color: #e2e8f0;
      background: #232f41;
      border-left-color: #ffd700;
    }
    .subsection:empty,
    .subsection:has(div:empty) {
      display: none;
    }
    .subsection-title[data-strand="ABM"] {
      border-left-color: #ff5722;
    }
    .subsection-title[data-strand="CulArts"] {
      border-left-color: #9c27b0;
    }
    .subsection-title[data-strand="ITMAWD"] {
      border-left-color: #4caf50;
    }
    .subsection-title[data-strand="STEM"] {
      border-left-color: #2196f3;
    }
    .subsection-title[data-strand="Grade 11"],
    .subsection-title[data-strand="Grade 12"] {
      border-left-color: #ff9800;
    }
    .filter-btn {
      border: 2px solid;
      font-weight: 600;
      transition: all 0.3s ease;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .filter-btn {
      background: #0057b8;
      color: white;
      border-color: #0057b8;
    }
    .filter-btn:hover {
      background: #003f8a;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,87,184,0.3);
    }
    .research-btn {
      background: #e7b624 !important;
      color: white !important;
      border-color: #f4c430 !important;
    }
    .research-btn:hover {
      background: #b19540 !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(244,196,48,0.3);
    }
    .capstone-btn {
      background: #0057b8 !important;
      color: white !important;
      border-color: #0057b8 !important;
    }
    .capstone-btn:hover {
      background: #003f8a !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,87,184,0.3);
    }
    .filter-btn.active {
      opacity: 0.7;
      transform: scale(0.95);
    }
    .button-container {
      display: inline-flex;
      gap: 20px;
      flex-wrap: wrap;
      vertical-align: middle;
    }
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #user-Icon {
      font-size: 30px;
      color: #0057b8;
    }
    .user-name h3 {
      margin: 0;
      font-size: 20px;
    }
    .user-name a {
      text-decoration: none;
      color: inherit;
    }
    .account-switcher {
      margin-left: auto;
    }
    .sidebar-content ul {
      margin-top: 20px;
    }
    .sidebar-content ul li a {
      color: #0057b8;
    }
    .text {
      transition: opacity 0.3s;
    }
    .dark-mode #user-Icon {
      color: #ffd700;
    }
    .dark-mode .sidebar-content ul li a {
      color: #ffd700;
    }
    .citation-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 10000 !important;
      justify-content: center;
      align-items: center;
    }
    .citation-modal.show {
      display: flex !important;
      animation: modalFadeIn 0.3s ease-out;
    }
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .citation-modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      position: relative;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      animation: modalContentFadeIn 0.3s ease-out 0.1s both;
      font-size: 14px;
      width: 600px;
      max-width: 90vw;
    }
    @keyframes modalContentFadeIn {
      from {
        opacity: 0;
        transform: translateY(-5px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .citation-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      position: relative;
    }
    .citation-modal-header h2 {
      margin: 0;
      color: #333;
      font-size: 1.2rem;
      font-weight: 600;
    }
    .citation-close {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: #666;
      padding: 3px;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }
    .citation-close:hover {
      background-color: #f0f0f0;
      color: #333;
    }
    .citation-format-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
      overflow-x: auto;
    }
    .citation-tab {
      background: none;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      border-bottom: 2px solid transparent;
      transition: all 0.3s;
      white-space: nowrap;
    }
    .citation-tab.active {
      color: #007bff;
      border-bottom-color: #007bff;
      background-color: #f8f9fa;
    }
    .citation-tab:hover {
      color: #007bff;
      background-color: #f8f9fa;
    }
    .citation-content {
       font-family: 'Courier New', monospace;
       font-size: 14px;
       line-height: 1.6;
       background-color: #f8f9fa;
       padding: 20px;
       border-radius: 8px;
       border-left: 4px solid #007bff;
       white-space: normal;
       word-wrap: break-word;
    }
    .citation-copy-btn {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 15px;
      transition: background-color 0.3s;
    }
    .citation-copy-btn:hover {
      background-color: #0056b3;
    }
    .citation-copy-btn.copied {
      background-color: #28a745;
    }
    .dark-mode .citation-modal-content {
      background-color: #2d2d2d;
      color: #ffffff;
    }
    .dark-mode .citation-modal-header {
      border-bottom-color: #444;
    }
    .dark-mode .citation-modal-header h2 {
      color: #ffffff;
    }
    .dark-mode .citation-close {
      color: #ccc;
    }
    .dark-mode .citation-close:hover {
      background-color: #3d3d3d;
      color: #ffffff;
    }
    .dark-mode .citation-format-tabs {
      border-bottom-color: #444;
    }
    .dark-mode .citation-tab {
      color: #ccc;
    }
    .dark-mode .citation-tab.active {
      color: #ffd700;
      border-bottom-color: #ffd700;
      background-color: #3d3d3d;
    }
    .dark-mode .citation-tab:hover {
      color: #ffd700;
      background-color: #3d3d3d;
    }
    .dark-mode .citation-content {
      background-color: #3d3d3d;
      color: #ffffff;
    }
    @media (max-width: 1200px) {
      .citation-modal-content {
        width: 700px;
        max-width: 85vw;
      }
    }
    @media (max-width: 992px) {
      .citation-modal-content {
        width: 650px;
        max-width: 90vw;
      }
    }
    @media (max-width: 768px) {
      .citation-modal-content {
        width: 95%;
        max-width: 95%;
        padding: 15px;
        margin: 10px;
        max-height: 80vh;
        overflow-y: auto;
      }
      .citation-format-tabs {
        flex-wrap: wrap;
        gap: 5px;
      }
      .citation-content {
        font-size: 12px;
        padding: 12px;
      }
      .citation-modal-header h2 {
        font-size: 1rem;
      }
      .citation-copy-btn {
        width: 100%;
        margin-top: 10px;
      }
    }
    @media (max-width: 576px) {
      .citation-modal-content {
        width: 98%;
        max-width: 98%;
        padding: 12px;
        margin: 5px;
        max-height: 85vh;
      }
      .citation-modal-header {
        padding-bottom: 8px;
        margin-bottom: 12px;
      }
      .citation-modal-header h2 {
        font-size: 0.9rem;
      }
      .citation-format-tabs {
        margin-bottom: 15px;
      }
      .citation-tab {
        padding: 8px 12px;
        font-size: 13px;
      }
      .citation-content {
        font-size: 11px;
        padding: 10px;
        font-family: 'Courier New', monospace;
      }
      .citation-copy-btn {
        padding: 6px 12px;
        font-size: 13px;
      }
    }
    @media (max-width: 480px) {
      .citation-modal-content {
        width: 100%;
        max-width: 100%;
        padding: 10px;
        margin: 2px;
        border-radius: 6px;
      }
      .citation-modal-header h2 {
        font-size: 0.85rem;
      }
      .citation-close {
        width: 22px;
        height: 22px;
        font-size: 16px;
      }
      .citation-format-tabs {
        gap: 3px;
      }
      .citation-tab {
        padding: 6px 8px;
        font-size: 12px;
      }
      .citation-content {
        font-size: 10px;
        padding: 8px;
        line-height: 1.4;
      }
    }
    .filter-dropdown-menu {
      min-width: 300px;
      max-width: 400px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      background: white;
      z-index: 1000;
    }
    .dark-mode .filter-dropdown-menu {
      background: #232f41;
      border-color: #374151;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .filter-section {
      margin-bottom: 20px;
    }
    .filter-section h3 {
      margin: 0 0 10px 0;
      color: #0057b8;
      font-size: 1rem;
      font-weight: 600;
    }
    .dark-mode .filter-section h3 {
      color: #ffd700;
    }
    .filter-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .filter-option-radio {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    .filter-option-radio:hover {
      background-color: #f8f9fa;
    }
    .dark-mode .filter-option-radio:hover {
      background-color: #374151;
    }
    .filter-option-radio input[type="radio"] {
      margin: 0;
    }
    .filter-option-radio label {
      cursor: pointer;
      margin: 0;
      font-weight: normal;
    }
    .filter-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }
    .filter-btn-modal {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    .filter-apply {
      background-color: #0057b8;
      color: white;
    }
    .filter-apply:hover {
      background-color: #003f8a;
    }
    .filter-clear {
      background-color: #6c757d;
      color: white;
    }
    .filter-clear:hover {
      background-color: #545b62;
    }
    .strand-section,
    .program-section {
      display: none;
    }
    .level-shs .strand-section {
      display: block;
    }
    .level-college .program-section {
      display: block;
    }
    /* NEW: Center nav-icons-center */
    .nav-icons-center {
      display: flex;
      justify-items: start;
      align-items: center;
      
      margin-left:31px;
    }
    .nav-icons-center .dropdown {
      margin: 0;
    }
    /* Ensure main navbar uses flex and centers content */
    .main-navbar {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      padding: 0 20px;
      position: relative;
    }
    .navbar-right {
      position: absolute;
      right: 20px;
    }
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 20px 0;
      padding: 10px;
    }
    .pagination button {
      padding: 8px 12px;
      border: 1px solid #ddd;
      background: white;
      color: #0057b8;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s;
    }
    .pagination button:hover {
      background: #f0f0f0;
    }
    .pagination button.active {
      background: #0057b8;
      color: white;
    }
    .pagination button:disabled {
      background: #f5f5f5;
      color: #ccc;
      cursor: not-allowed;
    }
    .dark-mode .pagination button {
      background: #374151;
      color: #e2e8f0;
      border-color: #4b5563;
    }
    .dark-mode .pagination button:hover:not(:disabled) {
      background: #4b5563;
    }
    .dark-mode .pagination button.active {
      background: #ffd700;
      color: #000;
    }
    .dark-mode .pagination button:disabled {
      background: #2d2d2d;
      color: #666;
    }
  </style>
</head>
<body>
  <nav class="main-navbar" id="main-navbar">
    <div class="STI-logo">
      <a href="Homepage.html"><img src="STI Logo.png" alt="STI Logo" class="sti-logo"></a>
      <a href="Homepage.html"><span>ARCHIVES</span></a>
    </div>
    <div class="nav-icons-center">
      <!-- Search bar -->
      <div class="search-filter-bar">
        <div class="search-container">
          <input type="text" id="articleSearch" placeholder="Search works, authors, or topics... " class="search-input">
          <div class="search-suggestions" id="searchSuggestions"></div>
        </div>
      </div>
      <!-- Research Dropdown -->
      <div class="dropdown">
        <div class="dropdown-toggle research-btn" onclick="window.location.href='library.html?category=research'">
          Research
        </div>
        <div class="dropdown-menu1">
          <div class="sub-dropdown">
            <div class="sub-dropdown-toggle" onclick="window.location.href='library.html?category=research&strand=Grade 11'">Grade 11</div>
            <div class="sub-dropdown-menu">
              <div data-strand="ABM" onclick="window.location.href='library.html?category=research&strand=ABM'">ABM</div>
              <div data-strand="CulArts" onclick="window.location.href='library.html?category=research&strand=CulArts'">CulArts</div>
              <div data-strand="ITMAWD" onclick="window.location.href='library.html?category=research&strand=ITMAWD'">ITMAWD</div>
              <div data-strand="STEM" onclick="window.location.href='library.html?category=research&strand=STEM'">STEM</div>
            </div>
          </div>
          <div class="sub-dropdown">
            <div class="sub-dropdown-toggle" onclick="window.location.href='library.html?category=research&strand=Grade 12'">Grade 12</div>
            <div class="sub-dropdown-menu">
              <div data-strand="ABM" onclick="window.location.href='library.html?category=research&strand=ABM'">ABM</div>
              <div data-strand="CulArts" onclick="window.location.href='library.html?category=research&strand=CulArts'">CulArts</div>
              <div data-strand="ITMAWD" onclick="window.location.href='library.html?category=research&strand=ITMAWD'">ITMAWD</div>
              <div data-strand="STEM" onclick="window.location.href='library.html?category=research&strand=STEM'">STEM</div>
            </div>
          </div>
        </div>
      </div>
      <!-- Capstone Dropdown -->
      <div class="dropdown">
        <button class="dropdown-toggle capstone-btn" onclick="window.location.href='library.html?category=capstone'">
          Capstone
        </button>
        <div class="dropdown-menu2">
          <div onclick="window.location.href='library.html?category=capstone&strand=BSBA'">BSBA</div>
          <div onclick="window.location.href='library.html?category=capstone&strand=BSCS'">BSCS</div>
          <div onclick="window.location.href='library.html?category=capstone&strand=BSIT'">BSIT</div>
        </div>
      </div>
    </div>
    <div class="navbar-right user-nav-fixed">
      <button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode">
        <i class="fa fa-moon"></i>
      </button>
      <i class="fa fa-user-circle" id="userIcon" style="cursor:pointer;"></i>
    </div>
  </nav>
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <div class="sidebar-content">
      <div class="user-info">
        <a href="pfp.html"><i class="fa fa-user-circle" id="user-Icon"></i></a>
        <div class="user-name">
          <a href="pfp.html"><h3>UserName</h3></a>
        </div>
      </div>
      <ul>
        <hr>
        <li><a href="library.html"><i class="fas fa-book"></i> Library</a></li>
        <li><a href="pfp.html"><i class="fa-solid fa-upload"></i> <span class="text">My Uploads</span></a></li>
        <li><a href="myspace.html"><i class="fa-solid fa-feather-pointed"></i> <span class="text">My Space</span></a></li>
        <hr>
        <li><a href="index.html"><i class="fas fa-exchange-alt"></i> <span class="text">Switch Acc</span></a></li>
        <li><a href="index.html"><i class="fa-solid fa-sign-out-alt"></i> <span class="text">Sign out</span></a></li>
      </ul>
    </div>
  </div>
  <div class="content-wrapper">
    <!-- Sidebar -->
    <div class="sidebarlft">
      <h3>Library</h3>
      <ul class="filter-list" data-filter-group="year">
        <li class="filter-option active" data-filter="any">Any time</li>
        <li class="filter-option" data-filter="2025">Since 2025</li>
        <li class="filter-option" data-filter="2024">Since 2024</li>
        <li class="filter-option" data-filter="2021">Since 2021</li>
        <li class="filter-option" data-filter="custom">Custom range...</li>
      </ul>
      <div class="custom-range" id="customRange" style="display: none; margin-top: 10px;">
        <input type="number" id="startYear" value="2024" style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;" />
        <span style="margin: 0 5px;">-</span>
        <input type="number" id="endYear" value="2025" style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;" />
        <br />
        <button id="applyCustomRange" style="margin-top: 5px; padding: 5px 10px; background: #0057b8; color: white; border: none; border-radius: 4px; cursor: pointer;">Search</button>
      </div>
      <h3>Sort</h3>
      <ul class="filter-list" data-filter-group="sort">
        <li class="filter-option active" data-filter="az">Sort A-Z</li>
        <li class="filter-option" data-filter="date">Sort by date</li>
        <li class="filter-option" data-filter="relevance">Sort by relevance</li>
      </ul>
      <h3>Type</h3>
      <ul class="filter-list" data-filter-group="type">
        <li class="filter-option active" data-filter="any">Any type</li>
        <li class="filter-option" data-filter="review">Review articles</li>
      </ul>
      <label><input type="checkbox" /> Include patents</label><br />
      <label><input type="checkbox" /> Include citations</label>
      <div class="create-alert">+ Create alert</div>
    </div>
    <!-- Main Content -->
    <div class="main">
      <!-- Hidden research section for dynamic content -->
      <div class="research-section" id="research-section" style="display: none;">
        <h2 class="section-title">Research Papers</h2>
        <div class="subsection">
          <h3 class="subsection-title">Grade 11</h3>
          <div class="grade-11-articles" id="grade-11-articles"></div>
        </div>
        <div class="subsection">
          <h3 class="subsection-title">Grade 12</h3>
          <div class="grade-12-articles" id="grade-12-articles"></div>
        </div>
        <div class="subsection">
          <h3 class="subsection-title">ABM</h3>
          <div class="abm-articles" id="abm-articles"></div>
        </div>
        <div class="subsection">
          <h3 class="subsection-title">CulArts</h3>
          <div class="cularts-articles" id="cularts-articles"></div>
        </div>
        <div class="subsection">
          <h3 class="subsection-title">ITMAWD</h3>
          <div class="itmawd-articles" id="itmawd-articles"></div>
        </div>
        <div class="subsection">
          <h3 class="subsection-title">STEM</h3>
          <div class="stem-articles" id="stem-articles"></div>
        </div>
      </div>
      <!-- Hidden capstone section for dynamic content -->
      <div class="capstone-section" id="capstone-section" style="display: none;">
        <h2 class="section-title">Capstone Projects</h2>
        <div class="capstone-articles" id="capstone-articles"></div>
      </div>
    </div>
  </div>
  <!-- Pagination -->
  <div class="pagination" id="pagination"></div>
  <!-- Footer -->
  <footer class="library-footer">
    <div class="footer-content">
      <span>&copy; 2025 STI Archives. All rights reserved.</span>
      <span>Made for STI College | ITMAWD 21</span>
    </div>
  </footer>
  <script src="script.js"></script>
  <script>
  // === UTILITIES ===
  function getRelativeTime(uploadDate) {
    const now = new Date();
    const upload = new Date(uploadDate);
    const diffMs = now - upload;
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    if (diffDays === 0) return 'today';
    if (diffDays === 1) return '1 day ago';
    if (diffDays < 30) return `${diffDays} days ago`;
    const diffMonths = Math.floor(diffDays / 30);
    if (diffMonths === 1) return '1 month ago';
    if (diffMonths < 12) return `${diffMonths} months ago`;
    const diffYears = Math.floor(diffDays / 365);
    return `${diffYears} year${diffYears > 1 ? 's' : ''} ago`;
  }

  function highlightText(text, searchTerm) {
    if (!searchTerm) return text;
    const regex = new RegExp(`(${searchTerm})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }

  // === INITIALIZE & LOAD ARTICLES ===
  function initializeArticles() {
    const existingArticles = [
        { title: 'Exploring Public Awareness And Safety Measures For Microplastic Consumption In Fish', authors: 'Caluya, C. I. L., Cejes, M. T. H. M., Habacon, K. L. R., Oliva, J. R. E., & Villegas, J. D.', meta: 'Caluya, C. I. L., Cejes, M. T. H. M., Habacon, K. L. R., Oliva, J. R. E., & Villegas, J. D. – 2024–2025', summary: 'This qualitative phenomenological study investigates public awareness, vendor practices, and government measures on microplastic contamination in fish, revealing low public knowledge, lack of standardized safety checks, and insufficient resources for proper monitoring...', category: 'research', strand: 'STEM', level: 'Senior High School', program: 'Grade 11', year: '2024', type: 'research', fileIds: ['1Gr3-XbFEkM4Y5hhT4jDABXus0htk3FBS'] },
        { title: 'Farmers\' Perceptions On The Effectiveness Of Ventilation To Hinder Pesticide Exposure', authors: 'Aquino, B. R. A., Burgos, F. E. D., Eliserio, C. A. C., Inoc, J. V. H., & Magbato, E. Y.', meta: 'Aquino, B. R. A., Burgos, F. E. D., Eliserio, C. A. C., Inoc, J. V. H., & Magbato, E. Y. – 2025', summary: 'This qualitative phenomenological study explores farmers\' perceptions of greenhouse ventilation as a strategy to reduce pesticide exposure, highlighting that proper airflow can improve crop health, reduce pesticide dependence, and promote safer and more sustainable farming practices...', category: 'research', strand: 'STEM', level: 'Senior High School', program: 'Grade 12', year: '2025', type: 'research', fileIds: ['1ZJd0BAeDr0wUiFzhm45hcwx6EGlIvwYG'] },
        { title: 'The Effectiveness of Lagundi Essential Oil as an Inhaler in Terms of Marketability Among Selected Grade-11 Senior High School Students in STI College Calamba', authors: 'Grade 11 Students', meta: 'Grade 11 Students – 2025 – STI College Calamba', summary: 'This study examines the marketability and effectiveness of lagundi essential oil as an inhaler product among selected Grade-11 students, evaluating consumer preferences, product viability, and potential market acceptance...', category: 'research', strand: 'STEM', level: 'Senior High School', program: 'Grade 11', year: '2025', type: 'research', fileIds: ['1nLccvtasOdYnOOWEDiUBBXQmj2nTelrZ'] },
        { title: 'Analyzing Safety Protocols Adherence In Gasoline Stations: Urban vs. Rural Perspectives', authors: 'Santibañez, J., et al.', meta: 'Santibañez, J., et al. – 2024 – STI College Calamba', summary: 'This study compares urban and rural gasoline stations to examine workers\' adherence to Department of Labor and Employment (DOLE) safety protocols, finding both compliance and lapses that impact health, safety, and emergency preparedness...', category: 'research', strand: 'ABM', level: 'college', program: 'BSBA', year: '2024', type: 'research', fileIds: ['1oycCEjyM5Wwlyz9HYzo8B-Hv_yjddemN'] },
        { title: 'Ethereal Blossom: Floral Scented Cologne Balm', authors: 'Baloloy, Winona Ashley I. Belda, Eldrich Seann T. Cubano, Rednz Nhorween C. Lulu, Kurl Angela C. Mendoza, Aizeiya N.', meta: 'Baloloy, Winona Ashley I. Belda, Eldrich Seann T. Cubano, Rednz Nhorween C. Lulu, Kurl Angela C. Mendoza, Aizeiya N. — 2025 STI College Calamba', summary: 'This feasibility study examines the market demand, financial viability, and marketing strategies for Ethereal Blossom, a floral cologne balm designed to combine elegance, skin-friendliness, and eco-consciousness for fragrance consumers...', category: 'research', strand: 'ABM', level: 'college', program: 'BSBA', year: '2025', type: 'research', fileIds: [] },
        { title: 'Trash to Treasure: The Role of Recycling Technologies in Sustainable Future', authors: 'Awid, Christa Belle L., Barerra, Tamiya Judea A., De Torres, Kent Hervey L., Gonzales, Christine Anne M., and Tuazon, Rancel G.', meta: 'Awid, Christa Belle L., Barerra, Tamiya Judea A., De Torres, Kent Hervey L., Gonzales, Christine Anne M., and Tuazon, Rancel G. – 2025 – STI College Calamba', summary: 'This study explores the perspectives of local government units on recycling technologies, highlighting their role in reducing waste, promoting sustainability, addressing implementation challenges, and balancing environmental goals with financial constraints...', category: 'research', strand: 'ITMAWD', level: 'college', program: 'BSIT', year: '2025', type: 'research', fileIds: ['1zGFTJMgLXbqTEwOhOK7YhcoJyGtHBYhn'] },
        { title: 'STI Archives: Digital Library Management System', authors: 'ITMAWD 21 Group', meta: 'ITMAWD 21 Group – 2025 – STI College Calamba', summary: 'A comprehensive web-based digital library system designed to manage and showcase student research papers and capstone projects...', category: 'capstone', strand: 'ITMAWD', level: 'college', program: 'BSIT', year: '2025', type: 'research', fileIds: [] },
        { title: 'AI-Powered Student Performance Analytics', authors: 'Computer Science Department', meta: 'Computer Science Department – 2025 – STI College Calamba', summary: 'An intelligent system that analyzes student performance data using machine learning algorithms...', category: 'capstone', strand: 'STEM', level: 'college', program: 'BSCS', year: '2025', type: 'research', fileIds: [] },
        { title: 'Sustainable Urban Farming Practices', authors: 'Environmental Science Team', meta: 'Environmental Science Team – 2025 – STI College Calamba', summary: 'This study explores innovative urban farming techniques that promote sustainability and food security in densely populated areas...', category: 'research', strand: 'STEM', level: 'Senior High School', program: 'Grade 11', year: '2025', type: 'research', fileIds: [] },
        { title: 'Mobile Health Monitoring App', authors: 'IT Development Group', meta: 'IT Development Group – 2025 – STI College Calamba', summary: 'A comprehensive mobile application for real-time health monitoring and telemedicine services...', category: 'capstone', strand: 'ITMAWD', level: 'college', program: 'BSIT', year: '2025', type: 'research', fileIds: [] },
        { title: 'E-Commerce Platform for Local Businesses', authors: 'Business Informatics Team', meta: 'Business Informatics Team – 2025 – STI College Calamba', summary: 'A scalable e-commerce solution designed to help local businesses establish online presence and manage digital sales...', category: 'capstone', strand: 'ITMAWD', level: 'college', program: 'BSIT', year: '2025', type: 'research', fileIds: [] },
        { title: 'Smart Campus Security System', authors: 'Security Systems Group', meta: 'Security Systems Group – 2025 – STI College Calamba', summary: 'An integrated security system utilizing IoT devices and AI for comprehensive campus surveillance and access control...', category: 'capstone', strand: 'ITMAWD', level: 'college', program: 'BSIT', year: '2025', type: 'research', fileIds: [] },
        { title: 'Virtual Reality Learning Environment', authors: 'Educational Technology Dept', meta: 'Educational Technology Dept – 2025 – STI College Calamba', summary: 'An immersive VR platform for interactive learning experiences across various academic disciplines...', category: 'capstone', strand: 'ITMAWD', level: 'college', program: 'BSIT', year: '2025', type: 'research', fileIds: [] },
        { title: 'Blockchain-Based Voting System', authors: 'Cybersecurity Research Team', meta: 'Cybersecurity Research Team – 2025 – STI College Calamba', summary: 'A secure and transparent voting system leveraging blockchain technology for elections and organizational decisions...', category: 'capstone', strand: 'ITMAWD', level: 'college', program: 'BSIT', year: '2025', type: 'research', fileIds: [] },
        { title: 'AI-Driven Financial Advisor', authors: 'Finance Technology Group', meta: 'Finance Technology Group – 2025 – STI College Calamba', summary: 'An intelligent financial planning tool that uses AI to provide personalized investment advice and portfolio management...', category: 'capstone', strand: 'ITMAWD', level: 'college', program: 'BSIT', year: '2025', type: 'research', fileIds: [] }
      ];
      localStorage.setItem('allArticles', JSON.stringify(existingArticles));
  }

  function loadUploadedArticles() {
    const allArticles = JSON.parse(localStorage.getItem('allArticles')) || [];
    allArticles.forEach(article => {
      const articleDiv = document.createElement('div');
      articleDiv.className = 'article';
      articleDiv.setAttribute('data-category', article.category);
      articleDiv.setAttribute('data-strand', article.strand);
      articleDiv.setAttribute('data-level', article.level);
      articleDiv.setAttribute('data-program', article.program);
      articleDiv.setAttribute('data-year', article.year);
      articleDiv.setAttribute('data-type', article.type);

      let studyId = article.title.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 20);
      if (article.title.includes('Lagundi')) studyId = 'lagundi_oil';
      if (article.title.includes('Farmers')) studyId = 'perceptions';

      articleDiv.innerHTML = `
        <h3><a href="myspace.html?study=${studyId}" style="text-decoration: none; color: inherit;">${article.title}</a></h3>
        <div class="meta">${article.meta}</div>
        <div class="summary">${article.summary}</div>
        <div class="source-tag">[STI College Calamba Library]</div>
        <div class="actions">
          <span>★ Save</span>
          <span onclick="openCitationModal(this)">Cite</span>
          <span onclick="showRelatedArticles(this)">Related articles</span>
        </div>
      `;

      // Append to correct hidden container
      if (article.category === 'research') {
        let container = null;
        if (article.program === 'Grade 11') container = document.getElementById('grade-11-articles');
        else if (article.program === 'Grade 12') container = document.getElementById('grade-12-articles');
        else if (article.strand === 'ABM') container = document.getElementById('abm-articles');
        else if (article.strand === 'CulArts') container = document.getElementById('cularts-articles');
        else if (article.strand === 'ITMAWD') container = document.getElementById('itmawd-articles');
        else if (article.strand === 'STEM') container = document.getElementById('stem-articles');
        if (container) container.appendChild(articleDiv);
        else document.querySelector('.research-section').appendChild(articleDiv);
      } else if (article.category === 'capstone') {
        const capContainer = document.getElementById('capstone-articles');
        if (capContainer) capContainer.appendChild(articleDiv);
        else document.querySelector('.capstone-section').appendChild(articleDiv);
      }
    });
  }

  let currentPage = 1;
  const articlesPerPage = 10;
  let allSortedArticles = [];
  let originalAllSortedArticles = [];
  let currentFilters = { year: 'any', sort: 'az', type: 'any' };
  let currentQuery = '';

  // === SHOW DEFAULT VIEW: ALL ARTICLES IN .main WITH PAGINATION ===
  function showDefaultResearchView() {
    const main = document.querySelector('.main');
    const researchSection = document.querySelector('.research-section');
    const capstoneSection = document.querySelector('.capstone-section');

    // Hide structured sections
    if (researchSection) researchSection.style.display = 'none';
    if (capstoneSection) capstoneSection.style.display = 'none';

    // Check URL for category filter
    const urlParams = new URLSearchParams(window.location.search);
    const categoryFilter = urlParams.get('category');

    // Get ALL articles from hidden containers
    const allArticles = [];
    const researchContainers = [
      'grade-11-articles', 'grade-12-articles',
      'abm-articles', 'cularts-articles', 'itmawd-articles', 'stem-articles'
    ];

    researchContainers.forEach(id => {
      const container = document.getElementById(id);
      if (container) {
        const articles = Array.from(container.querySelectorAll('.article'));
        allArticles.push(...articles);
        // Clear the container so articles don't appear twice
        container.innerHTML = '';
      }
    });

    // Get capstone articles
    const capstoneContainer = document.getElementById('capstone-articles');
    if (capstoneContainer) {
      const capstoneArticles = Array.from(capstoneContainer.querySelectorAll('.article'));
      allArticles.push(...capstoneArticles);
      capstoneContainer.innerHTML = '';
    }

    // Filter by category if specified
    let filteredArticles = allArticles;
    if (categoryFilter === 'research') {
      filteredArticles = allArticles.filter(article => article.getAttribute('data-category') === 'research');
    } else if (categoryFilter === 'capstone') {
      filteredArticles = allArticles.filter(article => article.getAttribute('data-category') === 'capstone');
    }

    // Sort A-Z
    allSortedArticles = filteredArticles.sort((a, b) =>
      a.querySelector('h3').textContent.localeCompare(b.querySelector('h3').textContent)
    );
    originalAllSortedArticles = [...allSortedArticles];

    // Set styles for articles
    allSortedArticles.forEach(article => {
      article.style.display = 'block';
      const category = article.getAttribute('data-category');
      if (category === 'research') {
        article.style.borderLeft = '4px solid #f4c430';
      } else if (category === 'capstone') {
        article.style.borderLeft = '4px solid #0057b8';
      }
    });

    // Render first page
    renderPage(1);
    renderPagination();
  }

  function renderPage(page) {
    currentPage = page;
    const main = document.querySelector('.main');

    // Clear existing articles in .main
    const existingInMain = main.querySelectorAll('.article');
    existingInMain.forEach(el => el.remove());

    const start = (page - 1) * articlesPerPage;
    const end = start + articlesPerPage;
    const articlesToShow = allSortedArticles.slice(start, end);

    articlesToShow.forEach(article => {
      main.appendChild(article);
    });
  }

  function renderPagination() {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    const totalPages = Math.ceil(allSortedArticles.length / articlesPerPage);

    if (totalPages <= 1) return;

    // Previous button
    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'Previous';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => { renderPage(currentPage - 1); renderPagination(); };
    pagination.appendChild(prevBtn);

    // Page numbers
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

    if (endPage - startPage + 1 < maxVisiblePages) {
      startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }

    for (let i = startPage; i <= endPage; i++) {
      const pageBtn = document.createElement('button');
      pageBtn.textContent = i;
      if (i === currentPage) pageBtn.classList.add('active');
      pageBtn.onclick = () => { renderPage(i); renderPagination(); };
      pagination.appendChild(pageBtn);
    }

    // Next button
    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => { renderPage(currentPage + 1); renderPagination(); };
    pagination.appendChild(nextBtn);
  }

  // === INIT ===
  document.addEventListener('DOMContentLoaded', () => {
    initializeArticles();
    loadUploadedArticles(); // Articles are now in hidden containers
    showDefaultResearchView(); // Move them to .main

    // Make articles clickable
    document.querySelectorAll('.article').forEach(article => {
      article.addEventListener('click', e => {
        if (e.target.closest('.actions') || e.target.tagName === 'A') return;
        const link = article.querySelector('h3 a');
        if (link) window.location.href = link.href;
      });
    });

    // Search functionality
    const searchInput = document.getElementById('articleSearch');
    searchInput.addEventListener('input', function() {
      const query = this.value.toLowerCase().trim();
      if (query === '') {
        allSortedArticles = [...originalAllSortedArticles];
      } else {
        allSortedArticles = originalAllSortedArticles.filter(article => {
          const title = article.querySelector('h3').textContent.toLowerCase();
          const meta = article.querySelector('.meta').textContent.toLowerCase();
          const summary = article.querySelector('.summary').textContent.toLowerCase();
          return title.includes(query) || meta.includes(query) || summary.includes(query);
        }).sort((a, b) => {
          const aTitle = a.querySelector('h3').textContent.toLowerCase();
          const bTitle = b.querySelector('h3').textContent.toLowerCase();
          const aStarts = aTitle.startsWith(query);
          const bStarts = bTitle.startsWith(query);
          if (aStarts && !bStarts) return -1;
          if (!aStarts && bStarts) return 1;
          return aTitle.localeCompare(bTitle);
        });
      }
      renderPage(1);
      renderPagination();
    });

    // Filter functionality
    document.querySelectorAll('.filter-option').forEach(option => {
      option.addEventListener('click', function() {
        const group = this.closest('ul').getAttribute('data-filter-group');
        let filter = this.getAttribute('data-filter');
        if (filter === 'custom') {
          document.getElementById('customRange').style.display = 'block';
          return; // Don't apply yet
        } else {
          document.getElementById('customRange').style.display = 'none';
        }
        currentFilters[group] = filter;
        // Remove active from siblings
        this.parentNode.querySelectorAll('.filter-option').forEach(sib => sib.classList.remove('active'));
        this.classList.add('active');
        updateArticles();
      });
    });

    // Custom range apply button
    document.getElementById('applyCustomRange').addEventListener('click', function() {
      const startYear = document.getElementById('startYear').value;
      const endYear = document.getElementById('endYear').value;
      if (startYear && endYear) {
        currentFilters.year = `custom-${startYear}-${endYear}`;
        // Set active on custom
        document.querySelectorAll('.filter-option[data-filter="custom"]').forEach(opt => opt.classList.add('active'));
        updateArticles();
      }
    });

    // Create alert
    document.querySelector('.create-alert').addEventListener('click', () => {
      alert('Create alert clicked');
    });
  });

  // === STUB FUNCTIONS (to prevent errors) ===
  function openCitationModal(el) { alert('Cite clicked'); }
  function showRelatedArticles(el) { alert('Related clicked'); }
</script>
</body>
</html>