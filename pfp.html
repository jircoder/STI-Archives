<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile STI ARCHIVES</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body  {
            min-height: 100vh;
            margin: 0;
            display:flex;
            flex-direction: column;
            font-family: 'Poppins', Arial, sans-serif;
            background: #fff;   /* FIXED background */
            max-width: 100vw;
            overflow-x: hidden;

        }
      
        .main-navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            top: 0;
            height: 65px;
            width: 100%;
            color: #595d69;
            background: #fff;
            box-shadow: 0 2px 8px #0001;
            padding: 0 12px;
            z-index: 1000;
            position: fixed;
            transition: height 0.3s ease;
        }

        .main-navbar.shrink {
            position: fixed;
            height: 50px;
            box-shadow: 0 4px 12px #0003;
        }
       
    .main-navbar  a{

    text-decoration: none;
    font-family: "Alan Sans";


}
       .sti-logo {
           display: flex;
           align-items: center;
           height: 40px;
           width: auto;
           border-radius: 6px;
           margin-left: 30px;
       }
       .sti-logo img {
           display: flex;
           align-items: center;
           height: 40px;
           width: auto;
           border-radius: 6px;
           margin-left: 30px;
       }

       .sti-logo span {
           font-size: 24px;
           font-weight: 700;
           color: #0057b8;
           margin-left: 10px;
           user-select: none;
       }
       
        .sti-logo a {
            text-decoration: none;
        }

        .main-navbar.shrink .sti-logo {
            height: 34px;
            margin-top: 0;
        }

        .main-navbar.shrink .sti-logo span {
            font-size: 22px;
        }

        .main-navbar.shrink .nav-text {
            font-size: 24px;
        }

        .main-navbar.shrink .navbar-right.user-nav-fixed .fa-user-circle {
            font-size: 26px;
        }

        .main-navbar.shrink .dark-mode-toggle {
            font-size: 20px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;

        }

        .nav-text {
            font-size: 18px;
            color: #1e1e1f;
            cursor: default;
            margin: 0;
        }
        
        .navbar-right.user-nav-fixed {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 14px;
            font-family: 'Poppins', Arial, sans-serif;
            font-weight: 600;
            color: #132a3f;
            font-size: 16px;
            z-index: 20;
        }

        .dark-mode-toggle {
            background: none;
            border: none;
            outline: none;
            cursor: pointer;
            margin-left: 8px;
            font-size: 24px;
            color: #666666;
            display: flex;
            align-items: center;
        }

        .dark-mode .dark-mode-toggle {
            color: #ffd700;
        }

        .fa-user-circle {
            font-size: 28px;
            color: #0057b8;
        }

        .dark-mode .fa-user-circle {
            color: #ffd700;
        }
        

        
        
        .navbar-right.user-nav-fixed {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 14px;
            font-family: 'Poppins', Arial, sans-serif;
            font-weight: 600;
            color: #132a3f;
            font-size: 18px;
            z-index: 20;
        }
        .navbar-right.user-nav-fixed .user-name {
            font-size: 18px;
            color: #132a3f;
            font-weight: 600;
            white-space: nowrap;
        }
        .navbar-right.user-nav-fixed .fa-user-circle {
            font-size: 32px;
            color: #0057b8;
        }
        .dark-mode .fa-user-circle {
            color: #ffd700;
        }
        .nav-icons-center {
             position: absolute;
             left: 50%;
             transform: translateX(-50%);
             display: flex;
             gap: 25px;
             color:#1e1e1f;
             align-items: center;
             font-family: 'Poppins', Arial, sans-serif;
             transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
         }
        
        
       
        
        .dark-mode .nav-text {
            color: #ffd700;
        }
        .dark-mode .main-navbar.shrink .nav-text {
            color: #ffd700;
        }
        
       /* Sidebar */
        .sidebar {
            position: fixed;
            top: 8%;
            margin-right:10px;
            right: -320px;
            width: 220px;
            height: 40%;
            background: #fff;
            box-shadow: -2px 0 16px #0002;
            z-index: 100;
            transition: right 0.3s cubic-bezier(.4,2,.6,1), visibility 0.3s;
            display: flex;
            flex-direction: column;
            visibility: hidden; /* Hide by default */
            pointer-events: none; /* Prevent interaction when hidden */
            z-index: 10002;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 24px;
        }
        .sidebar.open {
            right: 0;
            visibility: visible; /* Show when open */
            pointer-events: auto;
        }
        .sidebar-content {
            padding: 32px 24px 24px 24px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .close-sidebar {
            background: none;
            border: none;
            font-size: 2rem;
            color: #0057b8;
            align-self: flex-end;
            cursor: pointer;
            margin-bottom: 16px;
        }
        .sidebar-content h3 {
            margin: 0 0 24px 0;
            color: #0057b8;
            font-size: 1.3rem;
            font-weight: 700;
        }
        .sidebar-content ul {
             list-style: none;
             padding: 0 0 0 8px;
             margin: 0;
             flex: 1;
         }
        .sidebar-content ul li {
            margin-bottom: 5px;
        }
        .sidebar-content ul li a {
            color: #132a3f;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 500;
            transition: color 0.2s;
        }
        .sidebar-content ul li a:hover {
            color: #0057b8;
        }
        .account-switcher {
            margin-left: auto;
        }
        .sidebar-content ul {
            margin-top: 20px;
            font-size: 20px;
            font-weight: 600;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #user-Icon {
            font-size: 30px;
            color: #0057b8;
        }
        .user-name h3 {
            margin: 0;
            font-size: 20px;
        }
        .user-name a {
            text-decoration: none;
            color: inherit;
        }
        
        .dark-mode #user-Icon {
            color: #ffd700;
        }
        .dark-mode .fa-arrow-right-from-bracket {
            color: #ffd700 !important;
        }
        .sidebar-content ul li a {
            color: #0057b8;
            font-size: 1.1rem;
            font-weight: 500;
        }/*END SIDEBAR*/
        @media (max-width: 845px) {
            .hamburger {
                display: flex;
            }
            .nav-icons-center {
                display: none;
            }
        }

        .sdbr ul{
            list-style: none;
        }
        .sdbr1 {
            padding-top:20px;
            left:0;
            top:65px;
            width:200px;
            height: calc(100vh - 65px);
            z-index:10;
            position:fixed;
            justify-items: left;
            transition: width 0.3s ease;
        }

        .dark-mode .sdbr1 {
            background: #232f41;
        }

        .sdbr1.collapsed {
            width: 50px;
        }

        .sdbr1.collapsed .sdbr1-menu {
            display: none;
            transition: opacity 0.3s ease;
        }

        .sdbr1.collapsed .collapsed-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 20px;
            padding-top: 50px;
            width: 100%;
            text-align: center;
            transition: opacity 0.3s ease;
        }

        .collapsed-menu {
            display: none;
        }

        .collapsed-menu-item {
            font-size: 24px;
            color: #331801;
            cursor: pointer;
            transition: none;
            position: relative;
        }

        .dark-mode .collapsed-menu-item {
            color: #ffd700;
        }

        .collapsed-menu-item:hover {
            color: #0057b8;
        }

        .collapsed-dropdown {
            display: none;
            position: absolute;
            left: 100%;
            top: 0;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 10;
            min-width: 150px;
            padding: 8px 0;
        }

        .collapsed-menu-item:hover .collapsed-dropdown {
            display: block;
        }

        .collapsed-dropdown div {
            padding: 8px 16px;
            cursor: pointer;
            color: #331801;
            font-size: 14px;
            transition: background 0.2s ease;
        }

        .dark-mode .collapsed-dropdown div {
            color: #e2e8f0;
        }

        .collapsed-dropdown div:hover {
            background: rgba(0, 87, 184, 0.1);
        }

        .toggle-collapse {
            position: absolute;
            top: 10px;
            left: 10px;
            background: none;
            border: none;
            font-size: 20px;
            color: #331801;
            cursor: pointer;
            z-index: 15;
            padding-left:5px;

        }

        .dark-mode .toggle-collapse {
            color: #ffd700;
        }

        .sdbr1.collapsed .toggle-collapse {
            left: 50%;
            transform: translateX(-50%);
            padding:0px;
            transition: none;
        }
        .sdbr1-menu {
            list-style: none;
            text-decoration: none;
            padding: 0 0 0 30px;
            margin-top: 30px;
            font-size: 1rem;
            font-weight: 600;
            justify-items: left;
            
        }
        .sdbr1-menu li {
            margin-bottom: 15px;

        }
        .sdbr1-menu li {
            margin-bottom: 15px;
            text-decoration: none;
            color:#331801;
            transition: background 0.2s ease;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: normal;
        }

        .dark-mode .sdbr1-menu li {
            color:#e2e8f0;
        }

        .sdbr1-menu li:hover {
            background: rgba(0, 87, 184, 0.1);
        }

        .sdbr1-menu li.dropdown-item {
            cursor: pointer;
        }

        .sdbr1-menu li.dropdown-item:hover {
            background: rgba(0, 87, 184, 0.1);
        }

        .sdbr1-menu li.active {
            background: rgba(0, 87, 184, 0.2) !important;
            border-left: 3px solid #0057b8 !important;
        }

        .menu-header {
            cursor: default;
            padding: 10px 0;
            color: #000000;
            font-size: 1.5rem;
            font-weight: 600;
            justify-items: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            width: 100%;
            min-width: 140px;
            background: transparent;
            pointer-events: none;
        }

        .menu-header:hover {
            background: transparent;
        }

        .menu-header {
            cursor: default;
            padding: 10px 0;
            color: #000000;
            font-size: 1.5rem;
            font-weight: 600;
            justify-items: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            width: 100%;
            min-width: 140px;
            background: transparent;
            pointer-events: none;
        }

        .dark-mode .menu-header {
            color: #ffd700;
        }

        .menu-header:hover {
            background: transparent;
        }

        /* Account Settings Styles */
        .account-section {
            margin-bottom: 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .account-section:not(:last-child) {
            margin-bottom: 0;
        }

        .account-section h3 {
            margin: 0 0 15px 0;
            color: #0057b8;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .mini-profile-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .mini-background-image-container {
            position: relative;
            width: 120px;
            height: 70px;
            border-radius: 10px;
            
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .mini-pfp-container {
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            
            border: 3px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .mini-pfp-pic {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .mini-profile-buttons {
            display: flex;
            flex-direction: row;
            gap: 8px;
            margin-left: 20px;
        }

        .mini-upload-btn, .mini-delete-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s ease;
        }

        .mini-upload-btn {
            background: #0057b8;
            color: white;
        }

        .mini-upload-btn:hover {
            background: #003f8a;
        }

        .mini-delete-btn {
            background: #dc3545;
            color: white;
        }

        .mini-delete-btn:hover {
            background: #c82333;
        }

        .email-section {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0;
            background: white;
            border-radius: 6px;
        }

        .email-section input {
            flex: 1;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 1rem;
            background: white;
            color: #333;
        }

        .email-section input:focus {
            outline: none;
            border-color: #0057b8;
            box-shadow: 0 0 0 2px rgba(0, 87, 184, 0.25);
        }

        .email-section input[readonly] {
            background: #f8f9fa;
            cursor: not-allowed;
        }

        .update-email-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s ease;
        }

        .update-email-btn:hover {
            background: #218838;
        }

        .password-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 0;
        }

        .password-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-icon {
            position: absolute;
            left: 12px;
            color: #6c757d;
            font-size: 1rem;
        }

        .password-input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 1rem;
            background: white;
        }

        .password-input:focus {
            outline: none;
            border-color: #0057b8;
            box-shadow: 0 0 0 2px rgba(0, 87, 184, 0.25);
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            color: #6c757d;
            cursor: pointer;
            font-size: 1rem;
            transition: color 0.2s ease;
        }

        .password-toggle:hover {
            color: #0057b8;
        }

        .update-password-btn {
            align-self: flex-start;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s ease;
        }

        .update-password-btn:hover {
            background: #0056b3;
        }


        .name-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .name-row {
            display: flex;
            gap: 15px;
        }

        .name-input-group {
            flex: 1;
        }

        .name-input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
            font-size: 0.9rem;
        }

        .name-input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 1rem;
            background: white;
        }

        .name-input-group input:focus {
            outline: none;
            border-color: #0057b8;
            box-shadow: 0 0 0 2px rgba(0, 87, 184, 0.25);
        }

        .update-name-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s ease;
            margin-top: 15px;
        }

        .update-name-btn:hover {
            background: #218838;
        }

        /* Bio Section Styles */
        .bio-section {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .bio-section label {
            display: block;
            margin: 0 0 15px 0;
            font-size: 1rem;
            font-weight: 500;
            color: #333;
        }

        .bio-section textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
            background: white;
            color: #333;
        }

        .bio-section textarea:focus {
            outline: none;
            border-color: #0057b8;
            box-shadow: 0 0 0 2px rgba(0, 87, 184, 0.25);
        }

        .bio-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .update-bio-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s ease;
        }

        .update-bio-btn:hover {
            background: #218838;
        }

        .char-count {
            font-size: 0.85rem;
            color: #666;
        }
        .sdbr1-menu .sub-dropdown {
            position: relative;
            
        }
        .menu-header {
            cursor: default;
            padding: 10px 0;
            color: #000000;
            font-size: 1.5rem;
            font-weight: 600;
            justify-items: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            width: 100%;
            min-width: 140px;
            background: transparent;
        }
        .sdbr1-menu .sub-dropdown-menu {
            display: none;
            background: transparent;
            padding: 0;
        }
        .sdbr1-menu .sub-dropdown.open .sub-dropdown-menu {
            display: block;
        }
        .sdbr1-menu .sub-dropdown-menu .dropdown-item {
            padding: 6px 6px 6px 5px;
            cursor: pointer;
            transition: background 0.2s;
            color: #331801;
        }
        .dropdown-item:hover {
            background: #f8f9fa;
        }
        .fa-chevron-down {
            transition: transform 0.3s ease;
            font-size: 10px;
        }
        .sdbr1-menu .sub-dropdown.open .fa-chevron-down {
            transform: rotate(180deg);
            position: relative;
            left: 0;
        }
        

        .pfp-container {
            position: relative;
            width: 250px;
            height: 250px;
            border-radius: 50%;
            overflow: hidden;
            margin-top: 20px;

            flex-shrink: 0;
            cursor: default;
            transition: all 0.3s ease;
            border: 4px solid #fff;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        

        .pfp-pic {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            background-color: #444;
            transition: filter 0.3s ease;
        }

        .pfp-container:hover .pfp-pic {
            filter: none;
        }

        .pic-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            background: rgba(0, 87, 184, 0.8);

        }

        .pfp-container:hover .pic-overlay {
            opacity: 0;
        }

        .background-image-container {
            position: relative;
            margin-top: 20px;
            width: 80%;
            height: 300px;
            border-radius: 20px;
            overflow: visible;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .background-image-container:hover {
            /* No hover effects */
        }

        

        

       

        .edit-icon {
            color: #fff;
            padding: 6px;
            border-radius: 50%;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-info-block {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 475px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .status-row {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .status-cloud {
            position: absolute;
            top: -35px;
            right:-35px;
            background: #0b4dd1;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 0.9rem;
            color: white;
            
            align-items: center;
            z-index: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-cloud:hover {
            background: #0a42b8 !important;
            transform: translateY(-2px);
        }

        .status-bubble1 {
            position: absolute;
            top:-7px;
            left: -12px;
            width: 12px;
            height: 12px;
            background: #1455d5;
            border-radius: 50%;
        }

        .status-bubble2 {
            position: absolute;
            top:-4px;
            left: -7px;
            width: 20px;
            height: 20px;
            background: #1455d5;
            border-radius: 50%;
        }

        .full-name {
            font-size: 2.2rem;
            font-weight: bold;
            color: rgb(58, 58, 58);
        }


        .bio-text {
            font-size: 1rem;
            color: #666;
            margin-top: 8px;
            margin-bottom: 8px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        .divider{
            border: none;
            border-top: 1px solid #060606;
            margin: 20px auto;
            width: 80%;
            position: absolute;
            top: 550px;
            left: 50%;
            transform: translateX(-50%);
        }

        .saved-article {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 6px #0001;
            margin-bottom: 20px;
            border-left: 4px solid #0057b8;
            position: relative;
            cursor:pointer;
        }

        .saved-article-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .saved-article h3 {
            color: #0057b8;
            font-size: 1.1rem;
            margin: 0;
            flex: 1;
        }

        .remove-article-btn {
            background: transparent;
            color: #333;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s ease;
            margin-left: 10px;
        }

        .remove-article-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .saved-article .meta {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 10px;
        }

        .saved-article .summary {
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 10px;
        }

        .saved-article .saved-date {
            font-size: 0.8rem;
            color: #888;
            font-style: italic;
        }

        .article-pdf {
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .article-pdf iframe {
            border: none;
            border-radius: 8px;
        }

        .saved-document {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 6px #0001;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
            position: relative;
        }

        .saved-document-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .saved-document h3 {
            color: #0057b8;
            font-size: 1.1rem;
            margin: 0;
            flex: 1;
        }

        .remove-document-btn {
            background: transparent;
            color: #333;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s ease;
            margin-left: 10px;
        }

        .remove-document-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .saved-document .document-meta {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 10px;
        }

        .saved-document .document-content {
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }


        
        .sdbr2 {
            margin-top:65px;
            padding-top:80px;
            right:0%;
            width:299px;
            height: calc(100vh - 65px);
            z-index:10;
            position:fixed;
        }

        

        .dark-mode .sdbr2 .online-container {
            background-color: #374151;
            color: #e2e8f0;
        }

        .dark-mode .sdbr2 h3 {
            color: #ffd700;
        }

        .dark-mode .sdbr2 .online-user span {
            color: #e2e8f0;
        }

        .dark-mode .sec-content {
            background-color: #181f2a;
            color: #e2e8f0;
        }

        .dark-mode .profile-header {
            background-color: #374151;
        }

        .dark-mode .article {
            background-color: #232f41;
            color: #e2e8f0;
        }

        .dark-mode .article p {
            color: #e2e8f0;
        }
        .main-content{
            position: relative;
            height: 120vh;
            width: calc(100vw - 200px);
            margin-left:200px;
            margin-right:0px;
            margin-top:65px;
            overflow-x: hidden;
        }

        .main-content.expanded {
            width: calc(100vw - 50px);
            margin-left: 50px;
        }
        .reset-size-btn {
            position: absolute;
            top: 3px;
            left: 3px;

            color: rgb(35, 35, 35);
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: background 0.3s ease;
            z-index: 10;
        }
        .reset-size-btn:hover {
            background: #003f8a;
        }
        .upld-content{
            display: flex;
            flex-wrap: wrap;
            padding-top:30px;
            padding-left:20px;
            padding-right:20px;
            gap: 20px;
            height:auto;
            width:auto;

            background-color: #a97e7ebd;

        }

        .upload-section {
            padding: 20px;
            margin: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .upload-section h2 {
            color: #0057b8;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f9f9f9;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-area:hover,
        .upload-area.drag-over {
            border-color: #0057b8;
            background: #f0f8ff;
        }

        .upload-area i {
            font-size: 48px;
            color: #0057b8;
            margin-bottom: 15px;
        }

        .upload-area p {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .upload-area input[type="file"] {
            display: none;
        }
        .upld-boxes{
            background-color: #f0f0f0;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 206px;
            height: 250px;
            min-width: 150px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            resize: both;
            overflow: hidden;
            position: relative;
        }

        .upld-boxes .upld-dscrpt {
            width: 100%;
            text-align: center;
            padding: 0 10px 5px 10px;
            box-sizing: border-box;
        }

        .upld-boxes .upld-dscrpt small {
            display: block;
            line-height: 1.2;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .upld-boxes .upld-dscrpt small.description-text {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            max-height: 3.6em;
            line-height: 1.2;
        }

        .upload-drop-zone {
            border: 2px dashed #ccc;
            background-color: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-drop-zone:hover {
            border-color: #0057b8;
            background-color: #f0f8ff;
        }

        .upload-drop-zone.drag-over {
            border-color: #0057b8;
            background-color: #e6f3ff;
        }

        .upload-icon {
            font-size: 48px;
            color: #0057b8;
            margin-bottom: 15px;
        }

        .upload-text {
            text-align: center;
            color: #666;
        }

        .upload-text p {
            margin: 5px 0;
            font-size: 16px;
        }
        .upld-boxes:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .box-options-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s ease;
            z-index: 10;
        }

        .box-options-btn:hover {
            background: rgba(255, 255, 255, 1);
        }

        .box-options-menu {
            position: absolute;
            top: 45px;
            right: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 20;
            min-width: 120px;
            display: none;
        }

        .box-options-menu.show {
            display: block;
        }

        .box-options-menu div {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s ease;
            font-size: 14px;
        }

        .box-options-menu div:hover {
            background: #f8f9fa;
        }

        .box-options-menu div:first-child {
            border-bottom: 1px solid #eee;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
            z-index: 10;
            display: none;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .upld-boxes.show-delete .delete-btn {
            display: flex;
        }
        .upld-boxes img{
            width: calc(100% - 20px);
            height: calc(70% - 40px);
            max-width: calc(100% - 20px);
            max-height: calc(70% - 40px);
            object-fit: contain;
            margin-bottom: 15px;
        }


        

        

        

        

        

        

        .top-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .article{
            margin-left:0;
            width: 80%;
            border-radius: 20px;
            display: inline-block;
        }

        .article p {
            color:white;
            margin-right:320px;
        }

        .main-navbar a{
            text-decoration: none;
        }

        .STI-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .STI-logo span {
            font-size: 25px;
            color: #0057b8;
        }

        .STI-logo span .shrink {
            font-size: 18px;
            color: #0057b8;
        }

        .main-navbar a span{
            align-self: center;
        }

        .STI-logo a span{margin-bottom:20px;}

        /* Enhanced notification styles */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .profile-nav a.active {
            background-color: #0057b8 !important;
            color: white !important;
        }

        .profile-nav a.active:hover {
            background-color: #003f8a !important;
        }

        /* Drag and drop visual feedback */
        .profile-pic-container.drag-over {
            border: 3px dashed #0057b8 !important;
            background-color: rgba(0, 87, 184, 0.1) !important;
        }

        .toggle-sdbr2 {
            position: absolute;
            right: 299px;
            top: 50%;
            transform: translateY(-50%);
            width: 15px;
            height: 60px;
            background: #fff;
            border: 2px solid #0057b8;
            
            border-radius:15px 0px 0px 15px;
            display: flex;
            align-items: center;
            
            justify-content: center;
            cursor: pointer;
            font-size: 17px;
            color: #0057b8;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .toggle-sdbr2:hover {
            background: #0057b8;
            color: #fff;
        }

        .dark-mode .toggle-sdbr2 {
            background: #232f41;
            border-color: #ffd700;
            color: #ffd700;
        }

        .dark-mode .toggle-sdbr2:hover {
            background: #ffd700;
            color: #232f41;
        }
    </style>
</head>
<body>
    <nav class="main-navbar" id="main-navbar">
        <div class="sti-logo">
            <a href="Homepage.html"><img src="STI Logo.png" alt="STI Logo" ></a>
            <a href="Homepage.html"><span>ARCHIVES</span></a>
        </div>
        <div style="flex:1"></div>
        <div class="nav-center">
            <div class="nav-item">
                <a href="Homepage.html"><span class="nav-text">Home</span></a>
            </div>
            <div class="nav-item">
                <a href="library.html"><span class="nav-text">Library</span></a>
            </div>
            <div class="nav-item">
                <a href="#help"><span class="nav-text">About</span></a>
            </div>
        </div>
        <div class="navbar-right user-nav-fixed">
            <button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode">
                <i class="fa fa-moon"></i>
            </button>
            <i class="fa fa-user-circle" id="userIcon" style="cursor:pointer;"></i>
        </div>
    </nav>

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-content">
            <div class="user-info">
                <a href="pfp.html"><i class="fa fa-user-circle" id="user-Icon"></i></a>
                <div class="user-name">
                    <a href="pfp.html"><h3>UserName</h3></a>
                </div>

            </div>

            <ul>
                <hr>
                <li><a href="pfp.html"><i class="fa-solid fa-user"></i> <span class="text">Profile</span></a></li>
                <li><a href="pfp.html"><i class="fa-solid fa-upload"></i> <span class="text">My Uploads</span></a></li>
                <li style="margin-top: 10px;"><a href="myspace.html"><i class="fa-solid fa-feather-pointed"></i> <span class="text">My Space</span></a></li>
                <li><a href="pfp.html/#p-s-account"><i class="fa-solid fa-cog"></i> <span class="text">Settings</span></a></li>
                <hr>
                <li style="margin-top: 10px;"><a href="index.html"><i class="fa-solid fa-sign-out-alt"></i> <span class="text">Sign out</span></a></li>
            </ul>
        </div>
    </div>

    <section class="sdbr1" id="sdbr1">
        <button class="toggle-collapse" onclick="toggleSidebarCollapse()">☰</button>

        <ul class="sdbr1-menu">
            <li class="menu-header">Account</li>
            <li class="dropdown-item profile active" onclick="showSection('p-n-p', event)">Profile</li>
            <li class="menu-header">MyLibrary</li>
            <li class="dropdown-item myuploads" onclick="showSection('p-n-m', event)">MyUploads</li>
            <li class="dropdown-item saved-articles" onclick="showSection('p-n-b', event)">Saved Articles</li>
            <li class="dropdown-item saved-docs" onclick="showSection('p-n-docs', event)">Saved Documents</li>
            <li class="menu-header">Settings</li>
            <li class="dropdown-item account-settings" onclick="showSection('p-n-account', event)">Account Settings</li>
            <li class="dropdown-item terms" onclick="showSection('p-n-terms', event)">Terms and Conditions</li>
            <li class="dropdown-item privacy" onclick="showSection('p-n-privacy', event)">Privacy Policy</li>
        </ul>

        <div class="collapsed-menu">
            <div class="collapsed-menu-item" title="Profile">
                👤
                <div class="collapsed-dropdown">
                    <div onclick="showSection('p-n-p')">Profile</div>
                </div>
            </div>
            <div class="collapsed-menu-item" title="My Library">
                📚
                <div class="collapsed-dropdown">
                    <div onclick="showSection('p-n-m')">MyUploads</div>
                    <div onclick="showSection('p-n-b')">Saved Articles</div>
                    <div onclick="showSection('p-n-docs')">Saved Documents</div>
                </div>
            </div>
            <div class="collapsed-menu-item" title="Settings">
                ⚙️
                <div class="collapsed-dropdown">
                    <div onclick="showSection('p-n-account')">Account Settings</div>
                    <div onclick="showSection('p-n-terms')">Terms and Conditions</div>
                    <div onclick="showSection('p-n-privacy')">Privacy Policy</div>
                </div>
            </div>
        </div>

    </section>


    <section class="main-content">
        <div id="p-n-p" class="profile-section" style="display:none; text-align: center;">
            <div clas="pfp-p-container" style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                <div class="background-image-container" id="backgroundContainer" style="background-image: url('dbgc.png'); background-size: cover; background-position: center;">

                    <input type="file" id="backgroundUpload" accept="image/*" onchange="changeBackground(event)" style="display: none;" />
                    <div class="pfp-container" style="position: absolute; top: 175px; left: 50%; transform: translateX(-50%);">
                        <label for="pfp-profileUpload">
                            <img src="Screenshot 2025-09-10 204105.png" alt="Profile" class="pfp-pic" id="pfpPic" />
                            <div class="pic-overlay">
                                <div class="edit-icon">📷</div>
                            </div>
                        </label>
                        <input type="file" id="profileUpload" accept="image/*" onchange="changeProfile(event)" style="display: none;" />
                    </div>
                </div>

                <div class="profile-info-block" style="text-align: center;">
                    <div class="full-name">Username</div>
                    <div class="bio-text">This is my bio. Welcome to my profile!</div>
                    <div class="status-cloud" id="statusCloud">
                        <div class="status-bubble1"></div>
                        <div class="status-bubble2"></div>
                            + Add Status
                        </div>
                </div>
            </div>
        </div>
        <div id="p-n-m" class="profile-section" style="display:none;">
            <button class="reset-size-btn" title="Reset Box Sizes">
                <i class="fas fa-undo"></i>
            </button>
            <div class="upld-content">
                <div class="upld-boxes">
                    <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                    <div class="box-options-menu">
                        <div onclick="editBox(this)">✏️ Edit</div>
                        <div onclick="deleteBox(this)">🗑️ Delete</div>
                    </div>
                    <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                    <img src="paper2.png">
                    <div class="upld-dscrpt">Description</div>
                </div>
                <div class="upld-boxes">
                    <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                    <div class="box-options-menu">
                        <div onclick="editBox(this)">✏️ Edit</div>
                        <div onclick="deleteBox(this)">🗑️ Delete</div>
                    </div>
                    <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                    <img src="paper2.png">
                    <div class="upld-dscrpt">Description</div>
                </div>
                <div class="upld-boxes">
                    <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                    <div class="box-options-menu">
                        <div onclick="editBox(this)">✏️ Edit</div>
                        <div onclick="deleteBox(this)">🗑️ Delete</div>
                    </div>
                    <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                    <img src="paper2.png">
                    <div class="upld-dscrpt">Description</div>
                </div>
                <div class="upld-boxes">
                    <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                    <div class="box-options-menu">
                        <div onclick="editBox(this)">✏️ Edit</div>
                        <div onclick="deleteBox(this)">🗑️ Delete</div>
                    </div>
                    <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                    <img src="paper2.png">
                    <div class="upld-dscrpt">Description</div>
                </div>
                <div class="upld-boxes upload-drop-zone">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">
                        <p>Drag & drop files here</p>
                        <p>or click to upload</p>
                    </div>
                    <input type="file" id="file-upload" accept="application/pdf,.doc,.docx" multiple style="display: none;">
                </div>
            </div>
        </div>
        <div id="p-n-b" class="profile-section" style="display:none;">
            
            <div id="saved-articles-container">
                <!-- Saved articles will be loaded here -->
            </div>
        </div>
        <div id="p-n-s" class="profile-section" style="display:none;">
            <h2>Settings</h2>
            <p>Account settings and preferences.</p>
            <!-- Add more content as needed -->
        </div>
        <div id="p-n-docs" class="profile-section" style="display:none;">
            <div id="saved-documents-container">
                <!-- Saved documents will be loaded here -->
            </div>
        </div>
        
            
        <div id="p-n-account" class="profile-section" style="display:none;">
            <!-- Profile Picture Section -->
            <div class="account-section">
                <h3>Profile Picture</h3>
                <div class="mini-profile-container">
                    <div class="mini-background-image-container">
                        <div class="mini-pfp-container">
                            <img src="Screenshot 2025-09-10 204105.png" alt="Profile" class="mini-pfp-pic" id="miniPfpPic" />
                        </div>
                    </div>
                    <div class="mini-profile-buttons">
                        <button class="mini-upload-btn" onclick="document.getElementById('miniCoverUpload').click()">Upload Cover Photo</button>
                        <button class="mini-upload-btn" onclick="document.getElementById('miniProfileUpload').click()">Upload Profile Pic</button>
                        <button class="mini-delete-btn">Delete</button>
                        <input type="file" id="miniCoverUpload" accept="image/*" onchange="changeMiniCover(event)" style="display: none;" />
                        <input type="file" id="miniProfileUpload" accept="image/*" onchange="changeMiniProfile(event)" style="display: none;" />
                    </div>
                </div>

                <!-- Full Name Section -->
                <div class="name-section">
                    <div class="name-row">
                        <div class="name-input-group">
                            <label for="firstName">First Name</label>
                            <input type="text" id="firstName" value="John" />
                        </div>
                        <div class="name-input-group">
                            <label for="lastName">Last Name</label>
                            <input type="text" id="lastName" value="Doe" />
                        </div>
                    </div>
                    <button class="update-name-btn" onclick="updateName()">
                        <i class="fas fa-save"></i> Save Name
                    </button>
                </div>

                <!-- Bio Section -->
                <div class="bio-section">
                    <label for="userBio">Bio</label>
                    <textarea id="userBio" placeholder="Tell us about yourself..." rows="4" maxlength="500"></textarea>
                    <div class="bio-actions">
                        <button class="update-bio-btn" onclick="updateBio()">
                            <i class="fas fa-save"></i> Save Bio
                        </button>
                        <span class="char-count"><span id="bioCharCount">0</span>/500</span>
                    </div>
                </div>
            </div>

            <!-- Email Section -->
            <div class="account-section">
                <h3>Email</h3>
                <div class="email-section">
                    <input type="email" id="userEmailInput" value="user@sti.archives.clmb" readonly />
                    <button class="update-email-btn" onclick="updateEmail()">
                        <i class="fas fa-plus"></i> Update Email
                    </button>
                </div>
            </div>

            <!-- Password Section -->
            <div class="account-section">
                <h3>Password</h3>
                <div class="password-section">
                    <div class="password-input-container">
                        <i class="fas fa-lock password-icon"></i>
                        <input type="password" id="currentPassword" placeholder="Current password" class="password-input" value="usertesting" />
                        <i class="fas fa-eye password-toggle" onclick="togglePasswordVisibility('currentPassword')"></i>
                    </div>
                    <div class="password-input-container">
                        <i class="fas fa-lock password-icon"></i>
                        <input type="password" id="newPassword" placeholder="New password" class="password-input" />
                        <i class="fas fa-eye password-toggle" onclick="togglePasswordVisibility('newPassword')"></i>
                    </div>
                    <div class="password-input-container">
                        <i class="fas fa-lock password-icon"></i>
                        <input type="password" id="confirmPassword" placeholder="Confirm new password" class="password-input" />
                        <i class="fas fa-eye password-toggle" onclick="togglePasswordVisibility('confirmPassword')"></i>
                    </div>
                    <button class="update-password-btn">Update Password</button>
                </div>
            </div>
        </div>
        <div id="p-n-terms" class="profile-section" style="display:none;">
            

            <!-- Terms and Conditions Section -->
            <div class="account-section">
                <div class="terms-section" style="padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">1. Acceptance of Terms</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">By accessing and using STI Archives, you agree to comply with these Terms and Conditions. If you do not agree, please discontinue use of the service.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">2. User Accounts</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">Users must provide accurate information (such as full name and Registration Assessment Form). You are responsible for maintaining the confidentiality of your account and activities under it.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">3. Content Usage</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">All research papers, capstone projects, and other content in STI Archives are protected under copyright and academic integrity standards. Unauthorized downloading, copying, or distribution without permission is strictly prohibited and may result in penalties.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">4. Prohibited Activities</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">Uploading inappropriate, offensive, or non-academic content (e.g., unrelated images or PDFs).<br>Using another person's work without proper authorization.<br>Attempting to bypass security measures or misuse the website.<br>Violations may result in suspension of access for up to 1 month or permanent banning for repeated offenses.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">5. Privacy</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">Your personal information, including full name and RAF, is collected for verification and record purposes. For details, please review our Privacy Policy.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">6. Enforcement and Penalties</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">Users who take research files without authorization will face disciplinary actions, which may include temporary suspension, account restriction, or referral to STI College administration for further action.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">7. Termination</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">STI Archives reserves the right to suspend or terminate any account immediately, without prior notice, for violation of these terms.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">8. Disclaimer</h4>
                    <p style="margin: 0; color: #555;">STI Archives is provided on an "as is" basis. We make no warranties regarding uninterrupted access, completeness of content, or fitness for a particular purpose.</p>
                </div>
            </div>
        </div>

        <div id="p-n-privacy" class="profile-section" style="display:none;">
            

            <!-- Privacy Policy Section -->
            <div class="account-section">
                <div class="privacy-section" style="padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">1. Information We Collect</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">We collect the information you provide directly to us, such as when you create an account, upload academic work, or contact us for assistance. This may include your full name and Registration Assessment Form (RAF) for verification purposes.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">2. How We Use Your Information</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">The information we collect is used to verify user identity, manage and improve our services, process submissions, and communicate with you regarding your account and activities within STI Archives.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">3. Information Sharing</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">We do not sell, trade, or share your personal information with outside parties without your consent, except when required by school administration or applicable law.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">4. Your Rights</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">You have the right to request access, correction, or deletion of your personal information at any time. Please contact STI Archives support for such requests.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">5. Changes to This Policy</h4>
                    <p style="margin: 0 0 10px 0; color: #555;">We may update this Privacy Policy from time to time. Any changes will be posted on this page, and continued use of the website means acceptance of the updated policy.</p>

                    <h4 style="margin-top: 15px; margin-bottom: 8px; color: #0057b8;">6. Contact Us</h4>
                    <p style="margin: 0; color: #555;">If you have any questions or concerns about this Privacy Policy, please reach out to us through the STI Archives support system.</p>
                </div>
            </div>
        </div>
    </section>

    <script>
        
        // Profile Picture Upload Functionality
        function changeProfile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const profilePic = document.getElementById('pfpPic');
                    profilePic.src = e.target.result;

                    // Save to localStorage for persistence
                    localStorage.setItem('profilePicture', e.target.result);

                    // Show success notification
                    showNotification('Profile picture updated successfully!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        // Background Image Upload Functionality
        function changeBackground(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const backgroundContainer = document.getElementById('backgroundContainer');
                    backgroundContainer.style.backgroundImage = `url(${e.target.result})`;
                    backgroundContainer.style.backgroundSize = 'cover';
                    backgroundContainer.style.backgroundPosition = 'center';

                    // Save to localStorage for persistence
                    localStorage.setItem('backgroundImage', e.target.result);

                    // Show success notification
                    showNotification('Background image updated successfully!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }


        // Load saved images on page load
        function loadSavedImages() {
            const savedProfilePic = localStorage.getItem('profilePicture');
            const savedBackground = localStorage.getItem('backgroundImage');

            if (savedProfilePic) {
                document.getElementById('pfpPic').src = savedProfilePic;
                // Also update mini profile picture
                const miniPfpPic = document.getElementById('miniPfpPic');
                if (miniPfpPic) {
                    miniPfpPic.src = savedProfilePic;
                }
            }

            if (savedBackground) {
                const backgroundContainer = document.getElementById('backgroundContainer');
                backgroundContainer.style.backgroundImage = `url(${savedBackground})`;
                backgroundContainer.style.backgroundSize = 'cover';
                backgroundContainer.style.backgroundPosition = 'center';

                // Also update mini background
                const miniBackgroundContainer = document.querySelector('.mini-background-image-container');
                if (miniBackgroundContainer) {
                    miniBackgroundContainer.style.backgroundImage = `url(${savedBackground})`;
                    miniBackgroundContainer.style.backgroundSize = 'cover';
                    miniBackgroundContainer.style.backgroundPosition = 'center';
                }
            }
        }

        // Enhanced profile picture positioning and effects
        function initializeProfileFeatures() {
            const profilePicContainer = document.querySelector('.pfp-container');
            const profilePic = document.getElementById('pfpPic');

            // Remove click to upload functionality
            // profilePicContainer.addEventListener('click', function() {
            //     document.getElementById('profileUpload').click();
            // });

            // Add drag and drop functionality
            profilePicContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                profilePicContainer.classList.add('drag-over');
            });

            profilePicContainer.addEventListener('dragleave', function(e) {
                e.preventDefault();
                profilePicContainer.classList.remove('drag-over');
            });

            profilePicContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                profilePicContainer.classList.remove('drag-over');

                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePic.src = e.target.result;
                        localStorage.setItem('profilePicture', e.target.result);
                        showNotification('Profile picture updated successfully!', 'success');
                    };
                    reader.readAsDataURL(file);
                } else {
                    showNotification('Please drop a valid image file', 'error');
                }
            });

            // Add zoom functionality on double click
            let zoomLevel = 1;
            profilePicContainer.addEventListener('dblclick', function() {
                zoomLevel = zoomLevel === 1 ? 1.5 : 1;
                profilePic.style.transform = `scale(${zoomLevel})`;
                profilePic.style.transition = 'transform 0.3s ease';
            });

            // Add rotation functionality
            let rotation = 0;
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    rotation += 90;
                    profilePic.style.transform = `rotate(${rotation}deg)`;
                }
            });
        }

        // Notification system
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-message">${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            // Add notification styles
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#0057b8'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: slideInRight 0.3s ease;
                animation-fill-mode: forwards;
            `;
        
            // Style the close button
            const closeBtn = notification.querySelector('.notification-close');
            if (closeBtn) {
                closeBtn.style.cssText = `
                    background: none;
                    border: none;
                    color: white;
                    cursor: pointer;
                    font-size: 16px;
                    padding: 0;
                    margin-left: 10px;
                `;
            }

            document.body.appendChild(notification);

            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.animation = 'slideOutRight 0.3s ease';
                    notification.style.animationFillMode = 'forwards';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 3000);
        }

        // Status update functionality
        function initializeStatusFeatures() {
            const statusCloud = document.getElementById('statusCloud');

            statusCloud.addEventListener('click', function() {
                showStatusModal();
            });

            // Load saved status
            const savedStatus = localStorage.getItem('userStatus');
            if (savedStatus) {
                updateStatusDisplay(savedStatus);
            }
        }

        // Show status modal
        function showStatusModal() {
            const modal = document.createElement('div');
            modal.className = 'status-modal';
            modal.innerHTML = `
                <div class="status-modal-content">
                    <div class="status-modal-header">
                        <h3>Update Status</h3>
                        <button class="status-modal-close" onclick="closeStatusModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="status-modal-body">
                        <textarea id="statusInput" placeholder="What's on your mind?" rows="4"></textarea>
                        <div class="status-options">
                            <div class="status-emoji">
                                <span>😊</span><span>😢</span><span>🎉</span><span>💼</span><span>✈️</span><span>🍕</span>
                            </div>
                            <div class="status-privacy">
                                <select id="statusPrivacy">
                                    <option value="public">🌍 Public</option>
                                    <option value="friends">👥 Friends</option>
                                    <option value="private">🔒 Only Me</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="status-modal-footer">
                        <button class="status-btn cancel" onclick="closeStatusModal()">Cancel</button>
                        <button class="status-btn save" onclick="saveStatus()">Save Status</button>
                    </div>
                </div>
            `;

            // Add modal styles
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
                overflow: hidden;
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }

                .status-modal-content {
                    background: white;
                    border-radius: 12px;
                    width: 90%;
                    max-width: 500px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease;
                }

                @keyframes slideIn {
                    from { transform: translateY(-50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }

                .status-modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 20px;
                    border-bottom: 1px solid #eee;
                }

                .status-modal-header h3 {
                    margin: 0;
                    color: #0057b8;
                }

                .status-modal-close {
                    background: none;
                    border: none;
                    font-size: 20px;
                    cursor: pointer;
                    color: #666;
                }

                .status-modal-body {
                    padding: 20px;
                }

                #statusInput {
                    width: 100%;
                    border: 2px solid #ddd;
                    border-radius: 8px;
                    padding: 12px;
                    font-size: 16px;
                    resize: vertical;
                    font-family: inherit;
                }

                #statusInput:focus {
                    outline: none;
                    border-color: #0057b8;
                }

                .status-options {
                    margin-top: 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }

                .status-emoji span {
                    cursor: pointer;
                    font-size: 20px;
                    margin-right: 8px;
                    transition: transform 0.2s ease;
                }

                .status-emoji span:hover {
                    transform: scale(1.2);
                }

                .status-privacy select {
                    padding: 8px 12px;
                    border: 1px solid #ddd;
                    border-radius: 6px;
                    background: white;
                }

                .status-modal-footer {
                    padding: 20px;
                    border-top: 1px solid #eee;
                    display: flex;
                    justify-content: flex-end;
                    gap: 10px;
                }

                .status-btn {
                    padding: 10px 20px;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 500;
                    transition: background 0.3s ease;
                }

                .status-btn.cancel {
                    background: #f0f0f0;
                    color: #666;
                }

                .status-btn.cancel:hover {
                    background: #e0e0e0;
                }

                .status-btn.save {
                    background: #0057b8;
                    color: white;
                }

                .status-btn.save:hover {
                    background: #003f8a;
                }

                .dark-mode .status-modal-content {
                    background: #232f41;
                    color: #e2e8f0;
                }

                .dark-mode .status-modal-header {
                    border-bottom-color: #374151;
                }

                .dark-mode #statusInput {
                    background: #374151;
                    border-color: #4b5563;
                    color: #e2e8f0;
                }

                .dark-mode .status-modal-footer {
                    border-top-color: #374151;
                }

                .dark-mode .status-btn.cancel {
                    background: #374151;
                    color: #e2e8f0;
                }

                .dark-mode .status-btn.cancel:hover {
                    background: #4b5563;
                }
            `;

            document.head.appendChild(style);
            document.body.appendChild(modal);

            // Load existing status
            const savedStatus = localStorage.getItem('userStatus');
            if (savedStatus) {
                document.getElementById('statusInput').value = savedStatus;
            }

            // Add emoji click functionality
            const emojiSpans = modal.querySelectorAll('.status-emoji span');
            emojiSpans.forEach(emoji => {
                emoji.addEventListener('click', function() {
                    const input = document.getElementById('statusInput');
                    input.value += this.textContent + ' ';
                    input.focus();
                });
            });
        }

        // Close status modal
        function closeStatusModal() {
            const modal = document.querySelector('.status-modal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Save status
        function saveStatus() {
            const input = document.getElementById('statusInput');
            const privacy = document.getElementById('statusPrivacy');
            const status = input.value.trim();

            if (status) {
                const statusData = {
                    text: status,
                    privacy: privacy.value,
                    timestamp: new Date().toISOString()
                };

                localStorage.setItem('userStatus', status);
                localStorage.setItem('statusData', JSON.stringify(statusData));

                updateStatusDisplay(status);
                closeStatusModal();
                showNotification('Status updated successfully!', 'success');
            } else {
                showNotification('Please enter a status message', 'error');
            }
        }

        // Update status display
        function updateStatusDisplay(status) {
            const statusCloud = document.getElementById('statusCloud');
            const statusText = statusCloud.lastChild;

            if (statusText.nodeType === Node.TEXT_NODE) {
                statusText.textContent = status;
            } else {
                statusCloud.innerHTML = `
                    <div class="status-bubble1"></div>
                    <div class="status-bubble2"></div>
                    ${status}
                `;
            }
        }

        // Profile navigation functionality
        function showSection(id, event) {
            // Remove active class from all menu items
            const menuItems = document.querySelectorAll('.sdbr1-menu li');
            menuItems.forEach(item => item.classList.remove('active'));

            // Hide all sections
            const sections = document.querySelectorAll('.profile-section');
            sections.forEach(section => section.style.display = 'none');

            // Show target section
            const targetSection = document.getElementById(id);
            if (targetSection) {
                targetSection.style.display = 'block';

                // Load saved articles if showing saved articles section
                if (id === 'p-n-b') {
                    loadSavedArticles();
                }

                // Load saved documents if showing saved documents section
                if (id === 'p-n-docs') {
                    loadSavedDocuments();
                }
            }

            // Add active class to clicked menu item
            if (event && event.target) {
                const clickedItem = event.target.closest('li');
                if (clickedItem) {
                    clickedItem.classList.add('active');
                }
            }
        }

        // Load saved articles from localStorage
        function loadSavedArticles() {
            const container = document.getElementById('saved-articles-container');
            if (!container) return;

            container.innerHTML = '';

            // Get saved articles from localStorage
            const savedArticles = JSON.parse(localStorage.getItem('savedArticles')) || [];

            if (savedArticles.length === 0) {
                container.innerHTML = '<p>No saved articles yet.</p>';
                return;
            }

            savedArticles.forEach((article, index) => {
                const articleDiv = document.createElement('div');
                articleDiv.className = 'saved-article';

                // Determine border color based on category (matching library.html)
                let borderColor = '#0057b8'; // default
                if (article.category === 'research') {
                    borderColor = '#f4c430';
                } else if (article.category === 'capstone') {
                    borderColor = '#0057b8';
                }

                articleDiv.style.borderLeft = `4px solid ${borderColor}`;

                articleDiv.innerHTML = `
                    <div class="saved-article-header">
                        <h3>${article.title}</h3>
                        <button class="remove-article-btn" onclick="removeSavedArticle(${index})" title="Remove from saved">×</button>
                    </div>
                    <div class="meta">${article.meta}</div>
                    <div class="summary">${article.summary}</div>
                    <div class="saved-date">Saved on: ${new Date(article.savedDate).toLocaleDateString()}</div>
                    ${article.pdfUrl ? `<div class="article-pdf" style="display: none;"><iframe src="${article.pdfUrl}" width="100%" height="400px" frameborder="0" allowfullscreen></iframe></div>` : ''}
                `;

                // Make article clickable to go to myspace with article data, but not if clicking remove button
                articleDiv.onclick = (e) => {
                    if (!e.target.closest('.remove-article-btn')) {
                        // Store article data for myspace to load
                        localStorage.setItem('selectedArticle', JSON.stringify(article));
                        let studyId = article.title.toLowerCase().replace(/[^a-z0-9]/g, '').substring(0, 20);
                        if (article.title.includes('Lagundi')) studyId = 'lagundi_oil';
                        if (article.title.includes('Farmers')) studyId = 'perceptions';
                        window.location.href = 'myspace.html?study=' + encodeURIComponent(studyId);
                    }
                };

                container.appendChild(articleDiv);
            });
        }

        // Load saved documents from localStorage
        function loadSavedDocuments() {
            const container = document.getElementById('saved-documents-container');
            if (!container) return;

            container.innerHTML = '';

            // Get documents from both sources
            const savedDocuments = JSON.parse(localStorage.getItem('savedDocuments')) || [];
            const pfpDocuments = JSON.parse(localStorage.getItem('pfpDocuments')) || [];

            // Combine and remove duplicates based on ID
            const allDocuments = [...savedDocuments, ...pfpDocuments];
            const uniqueDocuments = allDocuments.filter((doc, index, self) =>
                index === self.findIndex(d => d.id === doc.id)
            );

            console.log('Loading saved documents:', uniqueDocuments); // Debug log

            if (uniqueDocuments.length === 0) {
                container.innerHTML = '<p>No saved documents yet.</p>';
                return;
            }

            uniqueDocuments.forEach((doc, index) => {
                const docDiv = document.createElement('div');
                docDiv.className = 'saved-document';
                docDiv.onclick = () => viewDocumentModal(doc);

                const sourceIndicator = doc.sentFromMyspace ? ' <small style="color: #28a745;">(From MySpace)</small>' : '';

                docDiv.innerHTML = `
                    <div class="saved-document-header">
                        <h3>${doc.title}${sourceIndicator}</h3>
                        <button class="remove-document-btn" onclick="removeSavedDocument(${doc.id}); event.stopPropagation();" title="Remove from saved">×</button>
                    </div>
                    <div class="document-meta">Author: ${doc.author || 'Unknown'} | Created: ${new Date(doc.date).toLocaleDateString()}</div>
                    <div class="document-content">${doc.content.substring(0, 200)}${doc.content.length > 200 ? '...' : ''}</div>
                `;
                container.appendChild(docDiv);
            });
        }

        // Listen for document save events from myspace.html
        window.addEventListener('storage', function(e) {
            if (e.key === 'documentUpdateTrigger' || e.key === 'savedDocuments' || e.key === 'pfpDocumentUpdate') {
                // Reload documents when myspace.html saves something
                const currentSection = document.querySelector('.profile-section[style*="display: block"]');
                if (currentSection && currentSection.id === 'p-n-docs') {
                    loadSavedDocuments();
                }
            }
        });

        // Listen for messages from myspace.html
        window.addEventListener('message', function(e) {
            if (e.data.type === 'documentSaved') {
                // Reload documents when myspace.html saves something
                const currentSection = document.querySelector('.profile-section[style*="display: block"]');
                if (currentSection && currentSection.id === 'p-n-docs') {
                    loadSavedDocuments();
                }
            }
        });

        // View document in modal
        function viewDocumentModal(doc) {
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'document-view-modal';
            modal.innerHTML = `
                <div class="document-view-modal-content">
                    <div class="document-view-modal-header">
                        <h2>${doc.title}</h2>
                        <button class="document-view-modal-close" onclick="closeDocumentModal()">&times;</button>
                    </div>
                    <div class="document-view-modal-body">
                        <div class="document-meta-info">
                            <p><strong>Author:</strong> ${doc.author || 'Unknown'}</p>
                            <p><strong>Created:</strong> ${new Date(doc.date).toLocaleDateString()}</p>
                            ${doc.sentFromMyspace ? '<p><strong>Source:</strong> <span style="color: #28a745;">Sent from MySpace</span></p>' : ''}
                        </div>
                        <div class="document-full-content">${doc.content}</div>
                    </div>
                </div>
            `;

            // Add modal styles
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;

            const style = document.createElement('style');
            style.textContent = `
                .document-view-modal-content {
                    background: white;
                    border-radius: 12px;
                    width: 90%;
                    max-width: 800px;
                    max-height: 90vh;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    display: flex;
                    flex-direction: column;
                }

                .document-view-modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 20px;
                    border-bottom: 1px solid #eee;
                }

                .document-view-modal-header h2 {
                    margin: 0;
                    color: #0057b8;
                    font-size: 1.5rem;
                }

                .document-view-modal-close {
                    background: none;
                    border: none;
                    font-size: 28px;
                    cursor: pointer;
                    color: #666;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                .document-view-modal-body {
                    padding: 20px;
                    overflow-y: auto;
                    flex: 1;
                }

                .document-meta-info {
                    margin-bottom: 20px;
                    padding: 15px;
                    background: #f8f9fa;
                    border-radius: 8px;
                }

                .document-meta-info p {
                    margin: 5px 0;
                    color: #555;
                }

                .document-full-content {
                    background: #fff;
                    border: 1px solid #ddd;
                    border-radius: 0;
                    padding: 1in;
                    width: 8.5in;
                    min-height: 11in;
                    max-width: 100%;
                    margin: 20px auto;
                    line-height: 1.15;
                    color: #000;
                    white-space: pre-wrap;
                    word-wrap: break-word;
                    font-family: 'Times New Roman', serif;
                    font-size: 12pt;
                    box-shadow: 0 0 10px rgba(0,0,0,0.1);
                    position: relative;
                }

                .document-full-content::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    height: 1in;
                    background: linear-gradient(to bottom, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 100%);
                    pointer-events: none;
                }

                .dark-mode .document-view-modal-content {
                    background: #232f41;
                    color: #e2e8f0;
                }

                .dark-mode .document-view-modal-header {
                    border-bottom-color: #374151;
                }

                .dark-mode .document-meta-info {
                    background: #374151;
                }

                .dark-mode .document-full-content {
                    background: #2d2d2d;
                    color: #e2e8f0;
                    border-color: #555;
                    box-shadow: 0 0 15px rgba(0,0,0,0.3);
                }

                .dark-mode .document-full-content::before {
                    background: linear-gradient(to bottom, rgba(45,45,45,0.8) 0%, rgba(45,45,45,0) 100%);
                }
            `;

            document.head.appendChild(style);
            document.body.appendChild(modal);

            // Close modal when clicking backdrop
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeDocumentModal();
                }
            });
        }

        // Close document view modal
        function closeDocumentModal() {
            const modal = document.querySelector('.document-view-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Remove saved document
        function removeSavedDocument(docId) {
            if (confirm('Are you sure you want to remove this saved document?')) {
                let savedDocuments = JSON.parse(localStorage.getItem('savedDocuments')) || [];
                let pfpDocuments = JSON.parse(localStorage.getItem('pfpDocuments')) || [];

                // Remove from both storage locations
                savedDocuments = savedDocuments.filter(doc => doc.id !== docId);
                pfpDocuments = pfpDocuments.filter(doc => doc.id !== docId);

                localStorage.setItem('savedDocuments', JSON.stringify(savedDocuments));
                localStorage.setItem('pfpDocuments', JSON.stringify(pfpDocuments));

                loadSavedDocuments(); // Reload the list
                showNotification('Document removed from saved documents!', 'success');
            }
        }

        // Remove saved article
        function removeSavedArticle(index) {
            if (confirm('Are you sure you want to remove this saved article?')) {
                let savedArticles = JSON.parse(localStorage.getItem('savedArticles')) || [];
                savedArticles.splice(index, 1);
                localStorage.setItem('savedArticles', JSON.stringify(savedArticles));
                loadSavedArticles(); // Reload the list
                showNotification('Article removed from saved articles!', 'success');
            }
        }

        function toggleDropdown(el) {
            const li = el.parentElement;
            li.classList.toggle('open');
        }

        function toggleSidebarCollapse() {
            const sidebar = document.getElementById('sdbr1');
            const mainContent = document.querySelector('.main-content');
            const toggleBtn = document.querySelector('.toggle-collapse');

            if (sidebar.classList.contains('collapsed')) {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('expanded');
                toggleBtn.textContent = '☰';
            } else {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('expanded');
                toggleBtn.textContent = '☰';
            }
        }


        // Dark mode functionality
        const darkModeToggle = document.getElementById('darkModeToggle');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedMode = localStorage.getItem('darkMode');

        function setDarkMode(on) {
            document.body.classList.toggle('dark-mode', on);
            darkModeToggle.innerHTML = on
                ? '<i class="fa fa-sun"></i>'
                : '<i class="fa fa-moon"></i>';
            localStorage.setItem('darkMode', on ? 'on' : 'off');
        }

        setDarkMode(savedMode === 'on' || (savedMode === null && prefersDark));
        darkModeToggle.onclick = () => {
            setDarkMode(!document.body.classList.contains('dark-mode'));
        };

        // Load saved name, email, and bio on page load
        function loadSavedName() {
            const savedFirstName = localStorage.getItem('userFirstName');
            const savedLastName = localStorage.getItem('userLastName');
            const savedEmail = localStorage.getItem('userEmail');
            const savedBio = localStorage.getItem('userBio');

            if (savedFirstName) {
                document.getElementById('firstName').value = savedFirstName;
            }
            if (savedLastName) {
                document.getElementById('lastName').value = savedLastName;
            }
            if (savedEmail) {
                document.getElementById('userEmailInput').value = savedEmail;
            }
            if (savedBio) {
                document.getElementById('userBio').value = savedBio;
                updateBioCharCount();
            }

            if (savedFirstName && savedLastName) {
                document.querySelector('.full-name').textContent = `${savedFirstName} ${savedLastName}`;
            }

            // Update bio display on profile page
            if (savedBio) {
                document.querySelector('.bio-text').textContent = savedBio;
            }
        }

        // Navbar shrink functionality
        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('main-navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('shrink');
            } else {
                navbar.classList.remove('shrink');
            }
        });

        // Initialize all features when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedImages();
            loadSavedName();
            initializeProfileFeatures();
            initializeStatusFeatures();
            showSection('p-n-p');
            // Set initial active state for Profile
            const profileItem = document.querySelector('.sdbr1-menu .dropdown-item.profile').closest('li');
            if (profileItem) {
                profileItem.classList.add('active');
            }
            initializeFileUpload();

            // Close dropdowns when clicking outside - disabled
            // document.addEventListener('click', function(e) {
            //     if (!e.target.closest('.sdbr1-menu')) {
            //         document.querySelectorAll('.sub-dropdown.open').forEach(li => li.classList.remove('open'));
            //     }
            // });

            // Add sidebar toggle functionality
            document.getElementById('userIcon').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('open');
            });

            // Add reset size functionality
            const resetBtn = document.querySelector('.reset-size-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    const boxes = document.querySelectorAll('.upld-boxes');
                    boxes.forEach(box => {
                        box.style.removeProperty('width');
                        box.style.removeProperty('height');
                    });
                    showNotification('Box sizes reset to original!', 'success');
                });
            }

            // Add toggle sdbr2 functionality
            const toggleBtn = document.getElementById('toggleSdbr2');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', toggleSdbr2);
            }

            // Add fadeOut animation
            const fadeOutStyle = document.createElement('style');
            fadeOutStyle.textContent = `
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(fadeOutStyle);
        });

        // File upload functionality
        function initializeFileUpload() {
            const uploadDropZone = document.querySelector('.upload-drop-zone');
            const fileInput = document.getElementById('file-upload');

            if (uploadDropZone && fileInput) {
                // Remove any existing click listeners to prevent duplicates
                const newUploadDropZone = uploadDropZone.cloneNode(true);
                uploadDropZone.parentNode.replaceChild(newUploadDropZone, uploadDropZone);

                // Re-query the element after replacement
                const freshUploadDropZone = document.querySelector('.upload-drop-zone');

                // Add click handler for upload drop zone
                let isFileDialogOpen = false;
                let clickTimeout;

                freshUploadDropZone.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    if (!isFileDialogOpen) {
                        isFileDialogOpen = true;

                        // Clear any existing timeout
                        if (clickTimeout) {
                            clearTimeout(clickTimeout);
                        }

                        fileInput.click();

                        // Reset the flag after a longer delay to prevent rapid clicking
                        clickTimeout = setTimeout(() => {
                            isFileDialogOpen = false;
                        }, 1000);
                    }
                });

                // Add drag and drop event listeners
                freshUploadDropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    freshUploadDropZone.classList.add('drag-over');
                });

                freshUploadDropZone.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    freshUploadDropZone.classList.remove('drag-over');
                });

                freshUploadDropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    freshUploadDropZone.classList.remove('drag-over');
                    handleFileUpload(e.dataTransfer.files);
                });

                fileInput.addEventListener('change', (e) => {
                    handleFileUpload(e.target.files);
                });
            }
        }

        // Global variable to store files for upload
        let filesToUpload = [];

        function handleFileUpload(files) {
            // Store files globally for later use
            filesToUpload = Array.from(files);
            // Show upload modal for file details
            showUploadModal(files);
        }

        function createUploadBox(file, customTitle = null, customAuthor = null, customDescription = null) {
            const upldContent = document.querySelector('.upld-content');
            const uploadDropZone = upldContent.querySelector('.upload-drop-zone');

            // Create new upload box
            const newBox = document.createElement('div');
            newBox.className = 'upld-boxes';

            // Use custom metadata if provided, otherwise use defaults
            const title = customTitle || file.name.replace(/\.[^/.]+$/, "");
            const author = customAuthor || "Unknown";
            const description = customDescription || `${file.type} • ${(file.size / 1024).toFixed(2)} KB`;

            // Handle different file types
            if (file.type.startsWith('image/')) {
                // For images, show the image
                const reader = new FileReader();
                reader.onload = function(e) {
                    newBox.innerHTML = `
                        <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                        <div class="box-options-menu">
                            <div onclick="editBox(this)">✏️ Edit</div>
                            <div onclick="deleteBox(this)">🗑️ Delete</div>
                        </div>
                        <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                        <img src="${e.target.result}" style="width: calc(100% - 20px); height: calc(70% - 40px); max-width: calc(100% - 20px); max-height: calc(70% - 40px); object-fit: contain;">
                        <div class="upld-dscrpt">
                            <strong>${title}</strong><br>
                            <small>by ${author}</small><br>
                            <small class="description-text">${description}</small>
                        </div>
                    `;
                    // Insert before the upload drop zone
                    upldContent.insertBefore(newBox, uploadDropZone);
                };
                reader.readAsDataURL(file);
            } else if (file.type === 'application/pdf') {
                // For PDFs, show the first page as canvas
                const reader = new FileReader();
                reader.onload = function(e) {
                    pdfjsLib.getDocument({data: e.target.result}).promise.then(function(pdf) {
                        pdf.getPage(1).then(function(page) {
                            const desiredHeight = 200; // Smaller for thumbnail
                            const viewport = page.getViewport({scale: 1});
                            const scale = (desiredHeight / viewport.height) * 2;
                            const scaledViewport = page.getViewport({scale: scale});

                            const canvas = document.createElement('canvas');
                            canvas.height = scaledViewport.height;
                            canvas.width = scaledViewport.width;
                            canvas.style.width = '100%';
                            canvas.style.height = '100%';
                            canvas.style.maxWidth = '100%';
                            canvas.style.maxHeight = '100%';
                            canvas.style.objectFit = 'contain';
                            canvas.style.borderRadius = '8px';

                            const renderContext = {
                                canvasContext: canvas.getContext('2d'),
                                viewport: scaledViewport
                            };

                            page.render(renderContext).promise.then(function() {
                                // Create the box HTML with the rendered canvas
                                newBox.innerHTML = `
                                    <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                                    <div class="box-options-menu">
                                        <div onclick="editBox(this)">✏️ Edit</div>
                                        <div onclick="deleteBox(this)">🗑️ Delete</div>
                                    </div>
                                    <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                                    <div style="width: calc(100% - 20px); height: calc(70% - 40px); display: flex; align-items: center; justify-content: center; overflow: hidden; border-radius: 8px;">
                                        ${canvas.outerHTML}
                                    </div>
                                    <div class="upld-dscrpt">
                                        <strong>${title}</strong><br>
                                        <small>by ${author}</small><br>
                                        <small class="description-text">${description}</small>
                                    </div>
                                `;
                                // Insert before the upload drop zone
                                upldContent.insertBefore(newBox, uploadDropZone);
                                console.log('PDF canvas inserted into upload box');
                            }).catch(function(renderError) {
                                console.error('Error rendering PDF page:', renderError);
                                // Fallback to file icon if rendering fails
                                const fileIcon = 'fa-file-pdf';
                                const fileColor = '#dc3545';
                                newBox.innerHTML = `
                                    <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                                    <div class="box-options-menu">
                                        <div onclick="editBox(this)">✏️ Edit</div>
                                        <div onclick="deleteBox(this)">🗑️ Delete</div>
                                    </div>
                                    <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                                    <div style="width: calc(100% - 20px); height: calc(70% - 40px); max-width: calc(100% - 20px); max-height: calc(100% - 40px); display: flex; align-items: center; justify-content: center;">
                                        <i class="fas ${fileIcon}" style="font-size: min(48px, calc(100% - 20px)); color: ${fileColor};"></i>
                                    </div>
                                    <div class="upld-dscrpt">
                                        <strong>${title}</strong><br>
                                        <small>by ${author}</small><br>
                                        <small class="description-text">${description}</small>
                                    </div>
                                `;
                                upldContent.insertBefore(newBox, uploadDropZone);
                            });
                        });
                    }).catch(function(error) {
                        console.error('Error loading PDF:', error);
                        // Fallback to file icon if PDF rendering fails
                        const fileIcon = 'fa-file-pdf';
                        const fileColor = '#dc3545';
                        newBox.innerHTML = `
                            <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                            <div class="box-options-menu">
                                <div onclick="editBox(this)">✏️ Edit</div>
                                <div onclick="deleteBox(this)">🗑️ Delete</div>
                            </div>
                            <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                            <div style="width: calc(100% - 20px); height: calc(70% - 40px); max-width: calc(100% - 20px); max-height: calc(100% - 40px); display: flex; align-items: center; justify-content: center;">
                                <i class="fas ${fileIcon}" style="font-size: min(48px, calc(100% - 20px)); color: ${fileColor};"></i>
                            </div>
                            <div class="upld-dscrpt">
                                <strong>${title}</strong><br>
                                <small>by ${author}</small><br>
                                <small class="description-text">${description}</small>
                            </div>
                        `;
                        upldContent.insertBefore(newBox, uploadDropZone);
                    });
                };
                reader.readAsArrayBuffer(file);
            } else {
                // For other documents, show file icon
                const fileIcon = 'fa-file';
                const fileColor = '#6c757d';

                newBox.innerHTML = `
                    <button class="box-options-btn" onclick="toggleBoxOptions(this)">⋮</button>
                    <div class="box-options-menu">
                        <div onclick="editBox(this)">✏️ Edit</div>
                        <div onclick="deleteBox(this)">🗑️ Delete</div>
                    </div>
                    <button class="delete-btn" onclick="confirmDelete(this)">×</button>
                    <div style="width: calc(100% - 20px); height: calc(70% - 40px); max-width: calc(100% - 20px); max-height: calc(100% - 40px); display: flex; align-items: center; justify-content: center;">
                        <i class="fas ${fileIcon}" style="font-size: min(48px, calc(100% - 20px)); color: ${fileColor};"></i>
                    </div>
                    <div class="upld-dscrpt">
                        <strong>${title}</strong><br>
                        <small>by ${author}</small><br>
                        <small class="description-text">${description}</small>
                    </div>
                `;
                // Insert before the upload drop zone
                upldContent.insertBefore(newBox, uploadDropZone);
            }
        }

        function showUploadModal(files) {
            const modal = document.createElement('div');
            modal.className = 'upload-modal';
            let filesList = '';
            let previewFile = null;
            for (let file of files) {
                filesList += `<li>${file.name} (${(file.size / 1024).toFixed(2)} KB)</li>`;
                if ((file.type === 'application/pdf' || file.type.includes('word') || file.type.includes('document')) && !previewFile) {
                    previewFile = file;
                }
            }

            // If no files provided, show empty modal for manual file selection
            if (files.length === 0) {
                filesList = '<li>No files selected. Click "Add File" to select files.</li>';
            }
            modal.innerHTML = `
                <div class="upload-modal-content">
                    <div class="upload-modal-header">
                        <h3>Upload Document</h3>
                        <button class="upload-modal-close" onclick="closeUploadModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="upload-modal-body">
                        <div class="modal-left">
                            ${previewFile ? (previewFile.type === 'application/pdf' ? `<div class="pdf-preview"><canvas id="pdf-canvas"></canvas></div>` : `<div class="file-preview"><embed src="${URL.createObjectURL(previewFile)}" type="${previewFile.type}" width="100%" height="400px" style="border: 1px solid #ddd; border-radius: 8px;"></embed></div>`) : ''}
                        </div>
                        <div class="modal-right">
                            <form class="upload-form">
                                <input type="text" id="doc-title" placeholder="Title" required>
                                <input type="text" id="doc-author" placeholder="Author">
                                <textarea id="doc-description" placeholder="Description" rows="3"></textarea>
                            </form>
                            <ul class="uploaded-files-list">
                                ${filesList.replace(/<li>(.*?)<\/li>/g, '<li><span class="file-info">$1</span><button class="file-delete-btn" onclick="removeFile(this)">🗑️</button></li>')}
                            </ul>
                            <div class="file-selection" id="file-selection-area" style="display: none;">
                                <input type="file" id="modal-file-upload" accept="application/pdf,.doc,.docx,image/*" multiple style="display: none;">
                                <button class="btn-add-file" onclick="document.getElementById('modal-file-upload').click()">Add File</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <div class="modal-buttons-left">
                            <button class="btn-add-file" onclick="addMoreFiles()">Add File</button>
                            <button class="btn-clear-all" onclick="clearAllFiles()">Clear All</button>
                        </div>
                        <div class="modal-buttons-right">
                            <button class="btn-cancel" onclick="closeUploadModal()">Cancel</button>
                            <button class="btn-upload" onclick="submitUpload()">Upload</button>
                        </div>
                    </div>
                </div>
            `;

            // Add modal styles
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
            `;

            const style = document.createElement('style');
            style.textContent = `
                .upload-modal-content {
                    background: white;
                    border-radius: 12px;
                    width: 60%;
                    height: 650px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    display: flex;
                    flex-direction: column;
                    animation: slideIn 0.3s ease;
                    overflow-y: auto;
                    overflow-x: hidden;
                }

                .upload-modal-content.has-additional {
                    overflow-y: auto;
                }

                .upload-modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 20px;
                    border-bottom: 1px solid #eee;
                    position: sticky;
                    top: 0;
                    background: white;
                    z-index: 10;
                }

                .upload-modal-header h3 {
                    margin: 0;
                    color: #0057b8;
                }

                .upload-modal-close {
                    background: none;
                    border: none;
                    font-size: 20px;
                    cursor: pointer;
                    color: #666;
                }

                .upload-modal-body {
                    padding: 20px;
                    display: flex;
                    height: 520px;
                }

                .modal-left {
                    flex: 1;
                    padding-right: 20px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    
                }

                .modal-right {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                }

                .modal-buttons {
                    padding: 20px;
                    border-top: 1px solid #eee;
                    display: flex;
                    justify-content: space-between;
                    gap: 10px;
                    background: white;
                }

                .modal-left {
                    flex: 1;
                    padding-right: 20px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    margin-bottom: 20px;
                }

                .pdf-preview, .file-preview {
                    max-width: 100%;
                    max-height: 450px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }

                .pdf-preview canvas, .file-preview embed {
                    max-width: 100%;
                    max-height: 100%;
                    object-fit: contain;
                    border-radius: 8px;
                }

                #pdf-canvas {
                    width: 100% !important;
                    height: auto !important;
                    max-width: 100%;
                    max-height: 450px;
                    
                }

                [id^="pdf-canvas-"] {
                    width: 100% !important;
                    height: auto !important;
                    max-width: 100%;
                    max-height: 450px;
                    margin-top: 20px;
                }

                .modal-right {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                }

                .pdf-preview {
                    
                    text-align: center;
                }


                .upload-form {
                    margin: 20px 0;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }

                .upload-form input, .upload-form textarea {
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    font-family: inherit;
                }

                .upload-form textarea {
                    resize: vertical;
                }

                #pdf-canvas {
                    max-width: 100%;
                    max-height: 450px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    object-fit: contain;
                    
                }

                [id^="pdf-canvas-"] {
                    max-width: 100%;
                    max-height: 450px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    object-fit: contain;
                    aspect-ratio: 1;
                    margin-top:20px;
                }

                .additional-modal-body {
                    padding: 20px;
                    margin-top: 20px;
                }

                .additional-modal-body .modal-left {
                    margin-top: 20px;
                    aspect-ratio: 1;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }

                .pdf-navigation {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 10px;
                    background: rgba(255, 255, 255, 0.9);
                    border-radius: 6px;
                    margin-top: 10px;
                }

                .pdf-nav-btn {
                    padding: 5px 10px;
                    border: 1px solid #ddd;
                    background: white;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                }

                .pdf-nav-btn:hover {
                    background: #f8f9fa;
                }

                .pdf-nav-btn:disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                }

                .pdf-page-info {
                    font-size: 12px;
                    color: #666;
                }

                .modal-buttons {
                    
                    display: flex;
                    justify-content: space-between;
                    gap: 10px;
                }

                .modal-buttons-left {
                    display: flex;
                    gap: 10px;
                }

                .btn-cancel, .btn-upload, .btn-add-file, .btn-clear-all {
                    padding: 10px 20px;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-weight: 500;
                }

                .btn-add-file {
                    background: #28a745;
                    color: white;
                }

                .btn-add-file:hover {
                    background: #218838;
                }

                .btn-clear-all {
                    background: #dc3545;
                    color: white;
                }

                .btn-clear-all:hover {
                    background: #c82333;
                }

                .btn-cancel {
                    background: #f0f0f0;
                    color: #666;
                }

                .btn-cancel:hover {
                    background: #e0e0e0;
                }

                .btn-upload {
                    background: #0057b8;
                    color: white;
                }

                .btn-upload:hover {
                    background: #003f8a;
                }

                .uploaded-files-list {
                    list-style: none;
                    padding: 0;
                    margin: 0;
                    background: #f9f9f9;
                    border-radius: 8px;
                    padding: 15px;
                    margin-top: auto;
                }

                .uploaded-files-list li {
                    padding: 8px 0;
                    border-bottom: 1px solid #eee;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }

                .file-info {
                    flex: 1;
                }

                .file-delete-btn {
                    background: none;
                    border: none;
                    color: #dc3545;
                    cursor: pointer;
                    padding: 5px;
                    border-radius: 3px;
                    transition: background 0.2s ease;
                    font-size: 16px;
                }

                .file-delete-btn:hover {
                    background: rgba(220, 53, 69, 0.1);
                }

                .uploaded-files-list li:last-child {
                    border-bottom: none;
                }

                .dark-mode .upload-modal-content {
                    background: #232f41;
                    color: #e2e8f0;
                }

                .dark-mode .upload-modal-header {
                    border-bottom-color: #374151;
                }

                .dark-mode .uploaded-files-list {
                    background: #374151;
                }
            `;

            document.head.appendChild(style);
            document.body.appendChild(modal);

            if (previewFile && previewFile.type === 'application/pdf') {
                renderPDF(previewFile);
            }

            // Handle file selection in modal
            const modalFileInput = modal.querySelector('#modal-file-upload');

            modalFileInput.addEventListener('change', function(e) {
                const newFiles = Array.from(e.target.files);
                if (newFiles.length > 0) {
                    // Add new files to the global array
                    filesToUpload = [...filesToUpload, ...newFiles];

                    // Update the files list display
                    let updatedFilesList = '';
                    for (let file of filesToUpload) {
                        updatedFilesList += `<li><span class="file-info">${file.name} (${(file.size / 1024).toFixed(2)} KB)</span><button class="file-delete-btn" onclick="removeFile(this)">🗑️</button></li>`;
                    }
                    const filesListElement = modal.querySelector('.uploaded-files-list');
                    filesListElement.innerHTML = updatedFilesList;

                    // Hide the add file button since we now have files
                    const fileSelectionArea = modal.querySelector('.file-selection');
                    if (fileSelectionArea) {
                        fileSelectionArea.style.display = 'none';
                    }

                    // Always update preview with the first file when adding new files
                    const firstFile = filesToUpload[0];
                    if (firstFile) {
                        const modalLeft = modal.querySelector('.modal-left');
                        if (firstFile.type === 'application/pdf') {
                            modalLeft.innerHTML = `<div class="pdf-preview"><canvas id="pdf-canvas"></canvas></div>`;
                            renderPDF(firstFile);
                        } else {
                            modalLeft.innerHTML = `<div class="file-preview"><embed src="${URL.createObjectURL(firstFile)}" type="${firstFile.type}" width="100%" height="400px" style="border: 1px solid #ddd; border-radius: 8px;"></embed></div>`;
                        }
                    }
                }
                // Reset the input value to allow re-selecting the same file
                setTimeout(() => {
                    e.target.value = '';
                }, 100);
            });
        }

        function renderPDF(file, canvasId) {
            const canvas = document.getElementById(canvasId || 'pdf-canvas');
            if (!canvas) return;

            const context = canvas.getContext('2d');

            const reader = new FileReader();
            reader.onload = function(e) {
                pdfjsLib.getDocument({data: e.target.result}).promise.then(function(pdf) {
                    pdf.getPage(1).then(function(page) {
                        const isAdditional = canvasId && canvasId.includes('-');
                        const desiredWidth = isAdditional ? 1000 : 1000; // Same width as original for consistent container sizing
                        const desiredHeight = isAdditional ? 400 : 400; // Same height as original for consistent container sizing

                        const viewport = page.getViewport({scale: 1});
                        const scaleHeight = desiredHeight / viewport.height;
                        const scaleWidth = desiredWidth / viewport.width;
                        const scale = Math.min(scaleHeight, scaleWidth) * 2; // Use same scale multiplier as original for consistent behavior

                        const scaledViewport = page.getViewport({scale: scale});
                        canvas.height = scaledViewport.height;
                        canvas.width = scaledViewport.width;

                        const renderContext = {
                            canvasContext: context,
                            viewport: scaledViewport
                        };
                        page.render(renderContext).promise.then(function() {
                            // Render completed successfully
                        }).catch(function(renderError) {
                            console.error('Error during PDF render:', renderError);
                        });
                    });
                }).catch(function(error) {
                    console.error('Error rendering PDF in modal:', error);
                });
            };
            reader.readAsArrayBuffer(file);
        }

        function closeUploadModal() {
            const modal = document.querySelector('.upload-modal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                modal.style.animationFillMode = 'forwards';
                setTimeout(() => {
                    modal.remove();
                    // Reset the file input to allow re-uploading the same files
                    const fileInput = document.getElementById('file-upload');
                    if (fileInput) {
                        fileInput.value = '';
                    }
                }, 300);
            }
        }

        function submitUpload() {
            // Get form data
            const title = document.getElementById('doc-title').value;
            const author = document.getElementById('doc-author').value;
            const description = document.getElementById('doc-description').value;

            if (!title) {
                showNotification('Please enter a title', 'error');
                return;
            }

            // Use the stored files from the global variable
            const files = filesToUpload;

            if (files.length === 0) {
                showNotification('Please select at least one file', 'error');
                return;
            }

            // Create upload boxes for each file with the provided metadata
            for (let file of files) {
                createUploadBox(file, title, author, description);
            }

            showNotification(`${files.length} file(s) uploaded successfully!`, 'success');
            closeUploadModal();
            // Reset the file input after successful upload
            const fileInput = document.getElementById('file-upload');
            if (fileInput) {
                fileInput.value = '';
            }
            // Clear the global files array
            filesToUpload = [];
        }

        // Remove file from upload list
        function removeFile(btn) {
            const li = btn.parentElement;
            const fileName = li.querySelector('.file-info').textContent.split(' (')[0]; // Extract filename

            // Remove from global files array
            filesToUpload = filesToUpload.filter(file => file.name !== fileName);

            li.remove();

            // Check if there are any files left
            const remainingFiles = document.querySelectorAll('.uploaded-files-list li');
            if (remainingFiles.length === 0) {
                // Show the add file button in place of the file list
                const fileSelectionArea = document.querySelector('.file-selection');
                if (fileSelectionArea) {
                    fileSelectionArea.style.display = 'block';
                }
                // Remove the preview area if no files left
                const modalLeft = document.querySelector('.modal-left');
                if (modalLeft) {
                    modalLeft.innerHTML = '';
                }
            } else {
                // Update preview with the next available file
                const firstFile = remainingFiles[0];
                const nextFileName = firstFile.querySelector('.file-info').textContent.split(' (')[0];

                // Find the corresponding file in the files array
                const nextFile = filesToUpload.find(file => file.name === nextFileName);
                if (nextFile) {
                    const modalLeft = document.querySelector('.modal-left');
                    if (modalLeft) {
                        if (nextFile.type === 'application/pdf') {
                            modalLeft.innerHTML = `<div class="pdf-preview"><canvas id="pdf-canvas"></canvas></div>`;
                            renderPDF(nextFile);
                        } else {
                            modalLeft.innerHTML = `<div class="file-preview"><embed src="${URL.createObjectURL(nextFile)}" type="${nextFile.type}" width="100%" height="400px" style="border: 1px solid #ddd; border-radius: 8px;"></embed></div>`;
                        }
                    }
                }
            }

            showNotification('File removed from upload list!', 'info');
        }

        // Add more files to upload
        function addMoreFiles() {
            // Create a new file input for additional files
            const additionalFileInput = document.createElement('input');
            additionalFileInput.type = 'file';
            additionalFileInput.accept = 'application/pdf,.doc,.docx';
            additionalFileInput.multiple = true;
            additionalFileInput.style.display = 'none';
            additionalFileInput.addEventListener('change', handleAdditionalFiles);
            document.body.appendChild(additionalFileInput);
            additionalFileInput.click();
            // Remove the input after file selection is handled
            additionalFileInput.addEventListener('change', function() {
                setTimeout(() => {
                    if (document.body.contains(additionalFileInput)) {
                        document.body.removeChild(additionalFileInput);
                    }
                }, 100);
            });
        }

        // Handle adding additional files
        function handleAdditionalFiles(event) {
            const files = event.target.files;
            if (files.length > 0) {
                // Create a new modal body section for the additional files
                const uploadModalContent = document.querySelector('.upload-modal-content');
                if (!uploadModalContent) return;

                const newModalBody = document.createElement('div');
                newModalBody.className = 'upload-modal-body additional-modal-body';
                newModalBody.innerHTML = `
                    <div class="modal-left">
                        ${files[0].type === 'application/pdf' ? `<div class="pdf-preview"><canvas id="pdf-canvas-${Date.now()}" style="width: 100% !important; height: auto !important; max-width: 100%; max-height: 450px;"></canvas></div>` : `<div class="file-preview"><embed src="${URL.createObjectURL(files[0])}" type="${files[0].type}" width="100%" height="450px" style="border: 1px solid #ddd; border-radius: 8px;"></embed></div>`}
                    </div>
                    <div class="modal-right">
                        <form class="upload-form">
                            <input type="text" id="additional-doc-title" placeholder="Title" required>
                            <input type="text" id="additional-doc-author" placeholder="Author">
                            <textarea id="additional-doc-description" placeholder="Description" rows="3"></textarea>
                        </form>
                        <div class="file-selection" style="display: none;">
                            <input type="file" accept="application/pdf,.doc,.docx,image/*" multiple style="display: none;">
                            <button class="btn-add-file" onclick="this.previousElementSibling.click()">Add File</button>
                        </div>
                        <ul class="uploaded-files-list">
                            ${Array.from(files).map(file => `<li><span class="file-info">${file.name} (${(file.size / 1024).toFixed(2)} KB)</span><button class="file-delete-btn" onclick="removeFile(this)">🗑️</button></li>`).join('')}
                        </ul>
                    </div>
                `;

                // Insert before the modal buttons
                const modalButtons = document.querySelector('.modal-buttons');
                if (modalButtons) {
                    uploadModalContent.insertBefore(newModalBody, modalButtons);
                    // Add class to enable scrolling when additional content is present
                    uploadModalContent.classList.add('has-additional');
                } else {
                    uploadModalContent.appendChild(newModalBody);
                }

                // Render PDF if needed (only first page, no navigation)
                if (files[0].type === 'application/pdf') {
                    const canvasId = newModalBody.querySelector('canvas').id;
                    renderPDF(files[0], canvasId);
                }
            }
            event.target.value = '';
        }

        // Add PDF page navigation
        function addPDFNavigation(modalBody, file) {
            const modalLeft = modalBody.querySelector('.modal-left');
            const pdfContainer = modalLeft.querySelector('.pdf-preview');

            // Create navigation controls
            const navControls = document.createElement('div');
            navControls.className = 'pdf-navigation';
            navControls.innerHTML = `
                <button class="pdf-nav-btn" onclick="previousPDFPage(this)">‹ Previous</button>
                <span class="pdf-page-info">Page <span class="current-page">1</span> of <span class="total-pages">-</span></span>
                <button class="pdf-nav-btn" onclick="nextPDFPage(this)">Next ›</button>
            `;

            pdfContainer.appendChild(navControls);

            // Store PDF info for navigation
            pdfContainer.pdfFile = file;
            pdfContainer.currentPage = 1;
            pdfContainer.totalPages = 0;

            // Load PDF to get total pages
            pdfjsLib.getDocument(URL.createObjectURL(file)).promise.then(function(pdf) {
                pdfContainer.totalPages = pdf.numPages;
                pdfContainer.querySelector('.total-pages').textContent = pdf.numPages;
                pdfContainer.pdfDoc = pdf;
            });
        }

        // Navigate to previous PDF page
        function previousPDFPage(btn) {
            const pdfContainer = btn.closest('.pdf-preview');
            if (pdfContainer.currentPage > 1) {
                pdfContainer.currentPage--;
                renderPDFPage(pdfContainer);
            }
        }

        // Navigate to next PDF page
        function nextPDFPage(btn) {
            const pdfContainer = btn.closest('.pdf-preview');
            if (pdfContainer.currentPage < pdfContainer.totalPages) {
                pdfContainer.currentPage++;
                renderPDFPage(pdfContainer);
            }
        }

        // Render specific PDF page
        function renderPDFPage(pdfContainer) {
            const canvas = pdfContainer.querySelector('canvas');
            const context = canvas.getContext('2d');

            pdfContainer.pdfDoc.getPage(pdfContainer.currentPage).then(function(page) {
                const desiredHeight = 480;
                const viewport = page.getViewport({scale: 1});
                const scale = (desiredHeight / viewport.height) * 2;
                const scaledViewport = page.getViewport({scale: scale});

                canvas.height = scaledViewport.height;
                canvas.width = scaledViewport.width;

                const renderContext = {
                    canvasContext: context,
                    viewport: scaledViewport
                };

                page.render(renderContext);

                // Update page info
                pdfContainer.querySelector('.current-page').textContent = pdfContainer.currentPage;
            });
        }

        // Clear all files from upload list
        function clearAllFiles() {
            const fileList = document.querySelector('.uploaded-files-list');
            if (fileList) {
                fileList.innerHTML = '';
            }

            // Clear the preview area
            const modalLeft = document.querySelector('.modal-left');
            if (modalLeft) {
                modalLeft.innerHTML = '';
            }

            // Reset the file input
            const fileInput = document.getElementById('file-upload');
            if (fileInput) {
                fileInput.value = '';
            }

            showNotification('All files cleared!', 'info');
        }

        // Toggle sdbr2 functionality
        function toggleSdbr2() {
            const sdbr2 = document.querySelector('.sdbr2');
            const mainContent = document.querySelector('.main-content');
            const toggleBtn = document.getElementById('toggleSdbr2');
            const span = toggleBtn.querySelector('span');
            const sidebar = document.getElementById('sdbr1');

            if (sdbr2.style.display === 'none') {
                sdbr2.style.display = 'block';
                mainContent.classList.remove('expanded');
                if (sidebar.classList.contains('collapsed')) {
                    mainContent.style.width = 'calc(100vw - 349px)';
                    mainContent.style.marginRight = '299px';
                } else {
                    mainContent.style.width = '67vw';
                    mainContent.style.marginRight = '299px';
                }
                toggleBtn.style.right = '299px';
                span.textContent = '>';
                document.body.style.overflowX = '';
            } else {
                sdbr2.style.display = 'none';
                mainContent.classList.add('expanded');
                if (sidebar.classList.contains('collapsed')) {
                    mainContent.style.width = 'calc(100vw - 50px)';
                    mainContent.style.marginRight = '0';
                } else {
                    mainContent.style.width = 'calc(100vw - 200px)';
                    mainContent.style.marginRight = '0';
                }
                toggleBtn.style.right = '0px';
                span.textContent = '<';
                document.body.style.overflowX = 'hidden';
            }
        }

        // Mini cover photo change functionality
        function changeMiniCover(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const miniBackgroundContainer = document.querySelector('.mini-background-image-container');
                    const mainBackgroundContainer = document.getElementById('backgroundContainer');
                    miniBackgroundContainer.style.backgroundImage = `url(${e.target.result})`;
                    mainBackgroundContainer.style.backgroundImage = `url(${e.target.result})`;

                    // Save to localStorage for persistence
                    localStorage.setItem('backgroundImage', e.target.result);

                    // Show success notification
                    showNotification('Cover photo updated successfully!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        // Mini profile picture change functionality
        function changeMiniProfile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const miniProfilePic = document.getElementById('miniPfpPic');
                    const mainProfilePic = document.getElementById('pfpPic');
                    miniProfilePic.src = e.target.result;
                    mainProfilePic.src = e.target.result;

                    // Save to localStorage for persistence
                    localStorage.setItem('profilePicture', e.target.result);

                    // Show success notification
                    showNotification('Profile picture updated successfully!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        // Update name functionality (manual save button)
        function updateName() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();

            if (firstName && lastName) {
                const fullName = `${firstName} ${lastName}`;
                document.querySelector('.full-name').textContent = fullName;
                localStorage.setItem('userFirstName', firstName);
                localStorage.setItem('userLastName', lastName);
                showNotification('Name updated successfully!', 'success');
            } else if (firstName || lastName) {
                const partialName = firstName || lastName;
                document.querySelector('.full-name').textContent = partialName;
                localStorage.setItem('userFirstName', firstName);
                localStorage.setItem('userLastName', lastName);
                showNotification('Name updated successfully!', 'success');
            } else {
                showNotification('Please enter at least a first name or last name', 'error');
            }
        }

        // Update email functionality
        function updateEmail() {
            const emailInput = document.getElementById('userEmailInput');
            const currentEmail = emailInput.value;

            if (emailInput.readOnly) {
                // Enable editing
                emailInput.readOnly = false;
                emailInput.focus();
                emailInput.select();
                document.querySelector('.update-email-btn i').className = 'fas fa-check';
                document.querySelector('.update-email-btn').innerHTML = '<i class="fas fa-check"></i> Save Email';
            } else {
                // Save changes
                const newEmail = emailInput.value.trim();
                if (newEmail && newEmail.includes('@') && newEmail !== currentEmail) {
                    emailInput.readOnly = true;
                    localStorage.setItem('userEmail', newEmail);
                    document.querySelector('.update-email-btn i').className = 'fas fa-plus';
                    document.querySelector('.update-email-btn').innerHTML = '<i class="fas fa-plus"></i> Update Email';
                    showNotification('Email updated successfully!', 'success');
                } else if (newEmail === currentEmail) {
                    emailInput.readOnly = true;
                    document.querySelector('.update-email-btn i').className = 'fas fa-plus';
                    document.querySelector('.update-email-btn').innerHTML = '<i class="fas fa-plus"></i> Update Email';
                } else {
                    showNotification('Please enter a valid email address', 'error');
                }
            }
        }

        // Toggle password visibility
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling;

            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash password-toggle';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye password-toggle';
            }
        }

        // Update bio functionality
        function updateBio() {
            const bioTextarea = document.getElementById('userBio');
            const bio = bioTextarea.value.trim();

            if (bio.length <= 500) {
                localStorage.setItem('userBio', bio);
                document.querySelector('.bio-text').textContent = bio || 'This is my bio. Welcome to my profile!';
                showNotification('Bio updated successfully!', 'success');
            } else {
                showNotification('Bio must be 500 characters or less', 'error');
            }
        }

        // Update bio character count
        function updateBioCharCount() {
            const bioTextarea = document.getElementById('userBio');
            const charCount = document.getElementById('bioCharCount');
            if (bioTextarea && charCount) {
                charCount.textContent = bioTextarea.value.length;
            }
        }

        // Add event listener for bio textarea
        document.addEventListener('DOMContentLoaded', function() {
            const bioTextarea = document.getElementById('userBio');
            if (bioTextarea) {
                bioTextarea.addEventListener('input', updateBioCharCount);
            }
        });

        // Toggle box options menu
        function toggleBoxOptions(btn) {
            const menu = btn.nextElementSibling;
            const allMenus = document.querySelectorAll('.box-options-menu');
            allMenus.forEach(m => {
                if (m !== menu) m.classList.remove('show');
            });
            menu.classList.toggle('show');
        }

        // Delete box functionality
        function deleteBox(element) {
            const box = element.closest('.upld-boxes');
            box.remove();
            showNotification('The Box was Deleted!', 'success');
            // Hide all menus
            document.querySelectorAll('.box-options-menu').forEach(menu => menu.classList.remove('show'));
        }

        // Confirm delete (shows delete button)
        function confirmDelete(btn) {
            const box = btn.closest('.upld-boxes');
            box.classList.toggle('show-delete');
        }

        // Edit box functionality - now shows upload modal
        function editBox(element) {
            const box = element.closest('.upld-boxes');
            window.currentEditingBox = box; // Store the box being edited

            // Get current content from the box
            const img = box.querySelector('img') || box.querySelector('div[style*="display: flex"]');
            const desc = box.querySelector('.upld-dscrpt');
            let currentTitle = '', currentAuthor = '', currentDescription = '';

            if (desc) {
                const strong = desc.querySelector('strong');
                const smalls = desc.querySelectorAll('small');
                if (strong) currentTitle = strong.textContent;
                if (smalls.length >= 2) {
                    currentAuthor = smalls[0].textContent.replace('by ', '');
                    currentDescription = smalls[1].textContent;
                }
            }

            // Create upload modal for editing
            const modal = document.createElement('div');
            modal.className = 'upload-modal';
            modal.innerHTML = `
                <div class="upload-modal-content">
                    <div class="upload-modal-header">
                        <h3>Upload Document</h3>
                        <button class="upload-modal-close" onclick="closeUploadModal()">&times;</button>
                    </div>
                    <div class="upload-modal-body">
                        <div class="modal-left">
                            <div class="file-preview-area">
                                ${img ? (img.tagName === 'IMG' ? `<img src="${img.src}" style="max-width: 100%; max-height: 100%; object-fit: contain;">` : img.outerHTML) : '<p>Preview will appear here</p>'}
                            </div>
                        </div>
                        <div class="modal-right">
                            <form class="upload-form">
                                <input type="text" id="edit-doc-title" placeholder="Title" value="${currentTitle}" required>
                                <input type="text" id="edit-doc-author" placeholder="Author" value="${currentAuthor}">
                                <textarea id="edit-doc-description" placeholder="Description" rows="3">${currentDescription}</textarea>
                            </form>
                            <div class="file-selection">
                                <input type="file" id="edit-file-upload" accept="application/pdf,.doc,.docx,image/*" style="display: none;">
                                <button class="btn-select-file" onclick="document.getElementById('edit-file-upload').click()">Select File</button>
                                <div id="selected-file-info" style="margin-top: 10px; font-size: 14px; color: #666;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <div class="modal-buttons-right">
                            <button class="btn-cancel" onclick="closeUploadModal()">Cancel</button>
                            <button class="btn-upload" onclick="saveEditedBox()">Save to Box</button>
                        </div>
                    </div>
                </div>
            `;

            // Add modal styles
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
            `;

            const style = document.createElement('style');
            style.textContent = `
                .upload-modal-content {
                    background: white;
                    border-radius: 12px;
                    width: 60%;
                    height: 650px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    display: flex;
                    flex-direction: column;
                    animation: slideIn 0.3s ease;
                    overflow-y: auto;
                }

                .upload-modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 20px;
                    border-bottom: 1px solid #eee;
                }

                .upload-modal-header h3 {
                    margin: 0;
                    color: #0057b8;
                }

                .upload-modal-close {
                    background: none;
                    border: none;
                    font-size: 20px;
                    cursor: pointer;
                    color: #666;
                }

                .upload-modal-body {
                    padding: 20px;
                    display: flex;
                    height: 520px;
                }

                .modal-left {
                    flex: 1;
                    padding-right: 20px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }

                .file-preview-area {
                    width: 100%;
                    height: 400px;
                    border: 2px dashed #ddd;
                    border-radius: 8px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    color: #666;
                    background: #f9f9f9;
                }

                .modal-right {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                }

                .upload-form {
                    margin-bottom: 20px;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }

                .upload-form input, .upload-form textarea {
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    font-family: inherit;
                }

                .file-selection {
                    margin-top: auto;
                }

                .btn-select-file {
                    padding: 10px 20px;
                    background: #0057b8;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                }

                .btn-select-file:hover {
                    background: #003f8a;
                }

                .modal-buttons {
                    padding: 20px;
                    border-top: 1px solid #eee;
                    display: flex;
                    justify-content: flex-end;
                    gap: 10px;
                }

                .btn-cancel, .btn-upload {
                    padding: 10px 20px;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-weight: 500;
                }

                .btn-cancel {
                    background: #f0f0f0;
                    color: #666;
                }

                .btn-upload {
                    background: #0057b8;
                    color: white;
                }

                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }

                @keyframes slideIn {
                    from { transform: translateY(-50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
            `;

            document.head.appendChild(style);
            document.body.appendChild(modal);

            // Handle file selection for edit modal
            const fileInput = modal.querySelector('#edit-file-upload');
            const fileInfo = modal.querySelector('#selected-file-info');
            const previewArea = modal.querySelector('.file-preview-area');

            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    fileInfo.textContent = `Selected: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;

                    // Show preview
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewArea.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                        };
                        reader.readAsDataURL(file);
                    } else if (file.type === 'application/pdf') {
                        previewArea.innerHTML = `<div style="text-align: center;"><i class="fas fa-file-pdf" style="font-size: 48px; color: #dc3545;"></i><p>${file.name}</p></div>`;
                    } else {
                        previewArea.innerHTML = `<div style="text-align: center;"><i class="fas fa-file" style="font-size: 48px; color: #6c757d;"></i><p>${file.name}</p></div>`;
                    }
                }
            });

            // Hide options menu
            document.querySelectorAll('.box-options-menu').forEach(menu => menu.classList.remove('show'));
        }

        // Close edit modal
        function closeEditModal() {
            const modal = document.querySelector('.edit-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Save edited box with uploaded content
        function saveEditedBox() {
            const title = document.getElementById('edit-doc-title').value;
            const author = document.getElementById('edit-doc-author').value;
            const description = document.getElementById('edit-doc-description').value;
            const fileInput = document.getElementById('edit-file-upload');
            const file = fileInput.files[0];

            if (!title) {
                showNotification('Please enter a title', 'error');
                return;
            }

            // Use the stored box being edited
            const box = window.currentEditingBox;
            const existingImg = box.querySelector('img') || box.querySelector('div[style*="display: flex"]');

            // If no new file selected but there's existing content, just update the text
            if (!file && existingImg) {
                const desc = box.querySelector('.upld-dscrpt');
                if (desc) {
                    desc.innerHTML = `
                        <div class="upld-dscrpt">
                            <strong>${title}</strong><br>
                            <small>by ${author || 'Unknown'}</small><br>
                            <small class="description-text">${description || 'No description'}</small>
                        </div>
                    `;
                }
                showNotification('Box content updated successfully!', 'success');
                closeUploadModal();
                return;
            }

            if (!file) {
                showNotification('Please select a file', 'error');
                return;
            }

            if (box) {
                const img = box.querySelector('img');
                const desc = box.querySelector('.upld-dscrpt');

                // Create file preview
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        img.src = e.target.result;
                        img.style.width = 'calc(100% - 20px)';
                        img.style.height = 'calc(70% - 40px)';
                        img.style.maxWidth = 'calc(100% - 20px)';
                        img.style.maxHeight = 'calc(70% - 40px)';
                        img.style.objectFit = 'contain';

                        // Update description with title, author, and description
                        desc.innerHTML = `
                            <div style="text-align: center; padding: 5px; margin: 0 8px; overflow: hidden;">
                                <strong style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-bottom: 2px;">${title}</strong>
                                <small style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-bottom: 1px;">by ${author || 'Unknown'}</small>
                                <small style="display: block; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; line-height: 1.2; max-height: 3.6em;">${description || 'No description'}</small>
                            </div>
                        `;

                        showNotification('File uploaded to box successfully!', 'success');
                    };
                    reader.readAsDataURL(file);
                } else {
                    // For non-image files, show file icon
                    const fileIcon = file.type === 'application/pdf' ? 'fa-file-pdf' : 'fa-file';
                    const fileColor = file.type === 'application/pdf' ? '#dc3545' : '#6c757d';

                    img.outerHTML = `<div style="width: calc(100% - 20px); height: calc(70% - 40px); max-width: calc(100% - 20px); max-height: calc(70% - 40px); display: flex; align-items: center; justify-content: center;">
                        <i class="fas ${fileIcon}" style="font-size: min(48px, calc(100% - 20px)); color: ${fileColor};"></i>
                    </div>`;

                    desc.innerHTML = `
                        <div style="text-align: center; padding: 5px; margin: 0 10px; overflow: hidden;">
                            <strong style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-bottom: 2px;">${title}</strong>
                            <small style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-bottom: 1px;">by ${author || 'Unknown'}</small>
                            <small style="display: block; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; line-height: 1.2; max-height: 3.6em;">${description || 'No description'}</small>
                        </div>
                    `;

                    showNotification('File uploaded to box successfully!', 'success');
                }
            }

            closeUploadModal();
        }

        // Close upload modal
        function closeUploadModal() {
            const modal = document.querySelector('.upload-modal');
            if (modal) {
                modal.remove();
            }
        }


        // Calendar functionality
        let currentDate = new Date();

        function renderCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const monthYear = document.getElementById('calendar-month-year');

            // Clear previous calendar
            calendarGrid.innerHTML = '';

            // Set month and year header
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            monthYear.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

            // Add day names
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day calendar-day-name';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });

            // Get first day of month and last day
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            // Generate calendar days
            const today = new Date();
            for (let i = 0; i < 42; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = startDate.getDate();

                // Check if current month
                if (startDate.getMonth() === currentDate.getMonth()) {
                    dayElement.classList.add('current-month');
                } else {
                    dayElement.classList.add('other-month');
                }

                // Check if today
                if (startDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }

                calendarGrid.appendChild(dayElement);
                startDate.setDate(startDate.getDate() + 1);
            }
        }

        // Calendar navigation
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        if (prevMonthBtn) {
            prevMonthBtn.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
        }
        if (nextMonthBtn) {
            nextMonthBtn.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
        }

        // Todo functionality
        function loadTodos() {
            const todos = JSON.parse(localStorage.getItem('todos')) || [];
            const todoList = document.getElementById('todo-list');
            todoList.innerHTML = '';

            todos.forEach((todo, index) => {
                const todoItem = document.createElement('div');
                todoItem.className = 'todo-item';
                todoItem.innerHTML = `
                    <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${index})">
                    <span class="todo-text ${todo.completed ? 'completed' : ''}">${todo.text}</span>
                    <button class="todo-delete" onclick="deleteTodo(${index})">×</button>
                `;
                todoList.appendChild(todoItem);
            });
        }

        function addTodo() {
            const input = document.getElementById('todo-input');
            const text = input.value.trim();

            if (text) {
                const todos = JSON.parse(localStorage.getItem('todos')) || [];
                todos.push({ text, completed: false });
                localStorage.setItem('todos', JSON.stringify(todos));
                input.value = '';
                loadTodos();
                showNotification('Todo added successfully!', 'success');
            }
        }

        function toggleTodo(index) {
            const todos = JSON.parse(localStorage.getItem('todos')) || [];
            todos[index].completed = !todos[index].completed;
            localStorage.setItem('todos', JSON.stringify(todos));
            loadTodos();
        }

        function deleteTodo(index) {
            const todos = JSON.parse(localStorage.getItem('todos')) || [];
            todos.splice(index, 1);
            localStorage.setItem('todos', JSON.stringify(todos));
            loadTodos();
            showNotification('Todo deleted!', 'info');
        }

        // Add todo on Enter key press
        const todoInput = document.getElementById('todo-input');
        if (todoInput) {
            todoInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addTodo();
                }
            });
        }

        // Add todo button click
        const addTodoBtn = document.getElementById('add-todo-btn');
        if (addTodoBtn) {
            addTodoBtn.addEventListener('click', addTodo);
        }

        // Initialize file upload on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeFileUpload();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + P to change profile picture
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                document.getElementById('profileUpload').click();
            }

            // Ctrl/Cmd + S to update status
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                document.getElementById('statusCloud').click();
            }
        });
    </script>
</body>
</html>
